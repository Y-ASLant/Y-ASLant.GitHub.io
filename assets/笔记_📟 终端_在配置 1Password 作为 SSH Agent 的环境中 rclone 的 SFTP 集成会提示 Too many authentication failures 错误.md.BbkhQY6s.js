import{_ as d,c as r,I as a,j as i,a as s,w as e,au as h,D as t,o}from"./chunks/framework.RMxno62p.js";const H=JSON.parse('{"title":"在配置 1Password 作为 SSH Agent 的环境中 rclone 的 SFTP 集成会提示 Too many authentication failures 错误","description":"","frontmatter":{"tags":["开源/软件/rclone","命令行/rclone","命令行/ssh","命令行/ssh-add","命令行/op","计算机/信息技术/安全/密码管理器/1Password","计算机/网络/协议/SFTP","计算机/网络/协议/SSH","命令行/systemd"]},"headers":[],"relativePath":"笔记/📟 终端/在配置 1Password 作为 SSH Agent 的环境中 rclone 的 SFTP 集成会提示 Too many authentication failures 错误.md","filePath":"笔记/📟 终端/在配置 1Password 作为 SSH Agent 的环境中 rclone 的 SFTP 集成会提示 Too many authentication failures 错误.md"}'),g={name:"笔记/📟 终端/在配置 1Password 作为 SSH Agent 的环境中 rclone 的 SFTP 集成会提示 Too many authentication failures 错误.md"},c=i("h1",{id:"在配置-1password-作为-ssh-agent-的环境中-rclone-的-sftp-集成会提示-too-many-authentication-failures-错误",tabindex:"-1"},[s("在配置 1Password 作为 SSH Agent 的环境中 "),i("code",null,"rclone"),s(" 的 SFTP 集成会提示 Too many authentication failures 错误 "),i("a",{class:"header-anchor",href:"#在配置-1password-作为-ssh-agent-的环境中-rclone-的-sftp-集成会提示-too-many-authentication-failures-错误","aria-label":'Permalink to "在配置 1Password 作为 SSH Agent 的环境中 `rclone` 的 SFTP 集成会提示 Too many authentication failures 错误"'},"​")],-1),y=h(`<h2 id="tl-dr" tabindex="-1">TL;DR <a class="header-anchor" href="#tl-dr" aria-label="Permalink to &quot;TL;DR&quot;">​</a></h2><p>配置 <code>sshd</code> 的 <code>MaxAuthTries</code> 选项即可：</p><div class="language-ssh-config vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ssh-config</span><pre class="shiki shiki-themes github-light one-dark-pro has-diff vp-code" tabindex="0"><code><span class="line diff remove"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># MaxAuthTries 6</span></span>
<span class="line diff add"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">MaxAuthTries</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 20</span></span></code></pre></div><h2 id="说明" tabindex="-1">说明 <a class="header-anchor" href="#说明" aria-label="Permalink to &quot;说明&quot;">​</a></h2><p>最近在做一些 <code>rclone</code> 相关的集成开发，在尝试使用 <code>rclone</code> 的 SFTP 协议集成的时候先是遇到了太长时间之后 <code>rclone</code> 无响应的问题：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">rclone</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ls</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> test-ssh:</span></span></code></pre></div><p>我的配置是这样的</p><div class="language-toml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">toml</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">test-ssh</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">type</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> = s</span><span style="--shiki-light:#B31D28;--shiki-dark:#FFFFFF;--shiki-light-font-style:italic;--shiki-dark-font-style:inherit;">ftp</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">user</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> = &lt;</span><span style="--shiki-light:#B31D28;--shiki-dark:#FFFFFF;--shiki-light-font-style:italic;--shiki-dark-font-style:inherit;">用户名&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">host</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> = &lt;</span><span style="--shiki-light:#B31D28;--shiki-dark:#FFFFFF;--shiki-light-font-style:italic;--shiki-dark-font-style:inherit;">服务器 IP&gt;</span></span></code></pre></div><p><code>rclone</code> 有支援通过 <code>-v</code> 和和多个 <code>v</code> 的 <code>-vvv</code> 来打印更详尽的日志输出的功能，打印和观察了之后发现它一直在遇到 Too many authentication failures 的错误问题：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">❯</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> rclone</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ls</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> test-ssh:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -vvv</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">2023/12/11</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 18:07:52</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> DEBUG</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> :</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> rclone:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Version</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;v1.65.0&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> starting</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> with</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> parameters</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;rclone&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;ls&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;test-ssh:&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;-vvv&quot;]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">2023/12/11</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 18:07:52</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> DEBUG</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> :</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Creating</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> backend</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> with</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> remote</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;test-ssh:&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">2023/12/11</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 18:07:52</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> DEBUG</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> :</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Using</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> config</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> file</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> from</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;/Users/neko/.config/rclone/rclone.conf&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">2023/12/11</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 18:07:52</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> DEBUG</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> :</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> pacer:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> low</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> level</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> retry</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 1/10</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (error </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">couldn&#39;t connect SSH: ssh: handshake failed: ssh: disconnect, reason 2: Too many authentication failures)</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">2023/12/11 18:07:52 DEBUG : pacer: Rate limited, increasing sleep to 200ms</span></span></code></pre></div><h2 id="解决" tabindex="-1">解决 <a class="header-anchor" href="#解决" aria-label="Permalink to &quot;解决&quot;">​</a></h2><p>我本地使用了 1Password 的 CLI 命令行工具集成 <code>op</code> 来提供 SSH Agent 的能力，方便我在无需关心和管理本地的实体公钥和私钥的情况下自动帮忙完成公钥发送、私钥校验和显式的权限控制的功能。</p><p>1Password 通过配置 <code>SSH_AUTH_SOCK</code> 环境变量来让所有与 SSH Agent 功能相兼容的工具在读取到环境变量的时候去与 SSH Agent 背后的 SSH Agent 服务提供软件通信并获取身份验证时候需要的密钥，完成整个密钥交换的流程。</p><p>通常这样的操作是在 <code>.zshrc</code> 中通过配置环境变量实现的：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro has-highlighted vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 1Password CLI shell completion</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">eval</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">op</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> completion zsh)&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">compdef</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> _op</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> op</span></span>
<span class="line highlighted"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 1Password CLI environment variables</span></span>
<span class="line highlighted"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> SSH_AUTH_SOCK</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">/.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">1password</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">agent</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">sock</span></span></code></pre></div><p>也会要求在 <code>.ssh/config</code> 中配置 <code>IdentityAgent</code> 字段来实现这部分的劫持行为：</p><div class="language-ssh-config vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ssh-config</span><pre class="shiki shiki-themes github-light one-dark-pro has-highlighted vp-code" tabindex="0"><code><span class="line highlighted"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">Host</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> *</span></span>
<span class="line highlighted"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  IdentityAgent</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> &quot;~/Library/Group Containers/2BUA8C4S2C.com.1password/t/agent.sock&quot; </span></span></code></pre></div><p>配置了 1Password 作为 SSH Agent 的情况下所有的 <code>ssh</code> 命令都可以交给 1Password 实现，我在使用相同的 IP 和用户名与服务端通信之后也验证了 1Password 其实是在工作的。</p><p>我觉得也许是我对 <code>rclone</code> 的理解不够深入，所以根据文档和交互式的 <code>rclone</code> 配置引导进行了调试和排查，我发现我的配置已经很简洁了，而且 <code>rclone</code> 也在官方文档中声明：</p>`,19),F=h("<p>If you don&#39;t specify <code>pass</code>, <code>key_file</code>, or <code>key_pem</code> or <code>ask_password</code> then rclone will attempt to contact an ssh-agent. You can also specify <code>key_use_agent</code> to force the usage of an ssh-agent. In this case <code>key_file</code> or <code>key_pem</code> can also be specified to force the usage of a specific key in the ssh-agent.</p>",1),C=h(`<p>这意味着我现在不指定 <code>pass</code>，<code>key_file</code>，<code>key_pem</code> 和 <code>ask_password</code> 的情况下，默认就会与 SSH Agent 通信并尝试完成密钥交互的流程。</p><p>我看到有人提示说可以通过</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">ssh-add</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -l</span></span></code></pre></div><p>来查看 SSH Agent 配置状态健康与否，是否有返回期望的密钥。</p><p>我尝试之后发现这里面有好多好多密钥：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">❯</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ssh-add</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -l</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">4096</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> SHA256:</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">has</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">h</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> SSH</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Key</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (RSA)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">256</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> SHA256::</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">has</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">h</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> SSH</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Key</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (ED25519)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">256</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> SHA256::</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">has</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">h</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> SSH</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Key</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 3</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (ED25519)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">3072</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> SHA256::</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">has</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">h</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> SSH</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Key</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 4</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (RSA)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">4096</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> SHA256::</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">has</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">h</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Certificate</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Signing</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Private</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Key</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (RSA)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">256</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> SHA256:::</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">has</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">h</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> SSH</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Key</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 5</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (ED25519)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">256</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> SHA256:::</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">has</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">h</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> SSH</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Signing</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Key</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (ED25519)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">3072</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> SHA256::</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">has</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">h</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> SSH</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Key</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 6</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (RSA)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">256</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> SHA256::</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">has</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">h</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> SSH</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Signing</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Key</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (ED25519)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">4096</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> SHA256::</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">has</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">h</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> SSH</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Key</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 7</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (RSA)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">4096</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> SHA256::</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">has</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">h</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Certificate</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Signing</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Private</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Key</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (RSA)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">4096</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> SHA256::</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">has</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">h</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> SSH</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Key</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 8</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (RSA)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">4096</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> SHA256::</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">has</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">h</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Certificate</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Signing</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Private</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Key</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 3</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (RSA)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">256</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> SHA256::</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">has</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">h</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> SSH</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Key</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 9</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (ED25519)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">3072</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> SHA256::</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">has</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">h</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> SSH</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Key</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 10</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (RSA)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">4096</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> SHA256::</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">has</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">h</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> SSH</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Key</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 11</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (RSA)</span></span></code></pre></div><p>那，难道是密钥太多了导致 <code>Too many authentication failures</code> ？</p><p>我之前确实遇到过，但是 <code>rclone</code> 并没有给出足够的信息告知我有多少的密钥被发送和交换了，我只能猜测说说不定是需要像 <code>ssh</code> 命令本身那样去声明公钥才行。</p><p>但是翻了好久 <code>rclone</code> 的文档都没有找到类似的配置选项，看起来没有什么办法。</p><p>直到我再次去阅读 1Password 中关于 SSH Agent 的文档的时候我才看到有关 <code>Too many authentication failures</code> 这样的一段话：</p>`,10),B=h('<p>If your SSH client offers the SSH server a seventh key, the server will refuse the connection and you&#39;ll see this error message in your SSH client:</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Too</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> many</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> authentication</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> failures</span></span></code></pre></div>',2),A=i("em",null,"can",-1),u=i("code",null,"MaxAuthTries",-1),_=i("code",null,"/etc/ssh/sshd_config",-1),S=h(`<p>好方向，我之前还真不知道 <code>sshd</code> 可以这样配置，于是我去服务端修改了一下 <code>MaxAuthTries</code> 的数值：</p><div class="language-ssh-config vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ssh-config</span><pre class="shiki shiki-themes github-light one-dark-pro has-diff vp-code" tabindex="0"><code><span class="line diff remove"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># MaxAuthTries 6</span></span>
<span class="line diff add"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">MaxAuthTries</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 20</span></span></code></pre></div><p>然后运行</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> sshd</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -t</span></span></code></pre></div><p>测试配置文件的有效性，再运行</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> restart</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> sshd</span></span></code></pre></div><p>来重启 SSH 服务。</p><p>这个时候用最初的配置文件再次运行</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">rclone</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ls</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> test-ssh:</span></span></code></pre></div><p>就发现能运行了！</p>`,10);function E(f,v,D,m,b,T){const l=t("NolebasePageProperties"),n=t("VPNolebaseInlineLinkPreview"),k=t("NolebaseGitContributors"),p=t("NolebaseGitChangelog");return o(),r("div",null,[c,a(l),y,i("blockquote",null,[F,i("p",null,[s("-- "),a(n,{href:"https://rclone.org/sftp/",target:"_blank",rel:"noreferrer"},{default:e(()=>[s("SFTP")]),_:1})])]),C,i("blockquote",null,[B,i("p",null,[s("Server administrators "),A,s(" increase the limit by setting "),u,s(" in the "),a(n,{href:"https://linux.die.net/man/5/sshd_config",target:"_blank",rel:"noreferrer"},{default:e(()=>[s("server's "),_]),_:1}),s(", but in many cases you can't (or don't want to) change this.")]),i("p",null,[s("-- "),a(n,{href:"https://developer.1password.com/docs/ssh/agent/advanced",target:"_blank",rel:"noreferrer"},{default:e(()=>[s("Advanced use cases | 1Password Developer")]),_:1})])]),S,a(k),a(p)])}const w=d(g,[["render",E]]);export{H as __pageData,w as default};
