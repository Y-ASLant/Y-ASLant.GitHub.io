import{_ as l,c as e,I as s,j as a,a as k,au as p,D as i,o as r}from"./chunks/framework.RMxno62p.js";const m=JSON.parse('{"title":"2023 年轮替 mTLS 证书","description":"","frontmatter":{"tags":["数学/密码学/证书/TLS/mTLS","数学/密码学/证书/TLS","数学/密码学/证书/PKI","命令行/openssl"]},"headers":[],"relativePath":"笔记/🔒 PKI 公钥基础设施/证书维护和轮替/记录/2023 年轮替 mTLS 证书.md","filePath":"笔记/🔒 PKI 公钥基础设施/证书维护和轮替/记录/2023 年轮替 mTLS 证书.md"}'),d={name:"笔记/🔒 PKI 公钥基础设施/证书维护和轮替/记录/2023 年轮替 mTLS 证书.md"},C=a("h1",{id:"_2023-年轮替-mtls-证书",tabindex:"-1"},[k("2023 年轮替 mTLS 证书 "),a("a",{class:"header-anchor",href:"#_2023-年轮替-mtls-证书","aria-label":'Permalink to "2023 年轮替 mTLS 证书"'},"​")],-1),g=p(`<p>这次维护用了 1Password 帮忙存储和读取 key，不过生成 Private key 的功能尚在 beta 阶段，所以还是先用 openssl 生成。</p><h3 id="创建今年的文件存储路径" tabindex="-1">创建今年的文件存储路径 <a class="header-anchor" href="#创建今年的文件存储路径" aria-label="Permalink to &quot;创建今年的文件存储路径&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">mkdir</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> clients/neko/2023</span></span></code></pre></div><h3 id="生成-private-key-和证书签发请求文件" tabindex="-1">生成 Private key 和证书签发请求文件 <a class="header-anchor" href="#生成-private-key-和证书签发请求文件" aria-label="Permalink to &quot;生成 Private key 和证书签发请求文件&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> genrsa</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -out</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> clients/neko/2023/client.pem</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 4096</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> req</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -new</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -key</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> clients/neko/2023/client.pem</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -out</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> clients/neko/2023/client.csr</span></span></code></pre></div><h3 id="创建证书拓展文件" tabindex="-1">创建证书拓展文件 <a class="header-anchor" href="#创建证书拓展文件" aria-label="Permalink to &quot;创建证书拓展文件&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">cat</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> clients/neko/2023/client.ext</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> &lt;&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;"> EOF</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">basicConstraints = CA:FALSE</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">nsCertType = client, email</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">nsComment = &quot;Ayaka Home Users Certificates&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">subjectKeyIdentifier = hash</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">authorityKeyIdentifier = keyid,issuer</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">keyUsage = critical, nonRepudiation, digitalSignature, keyEncipherment</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">extendedKeyUsage = clientAuth, emailProtection</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">EOF</span></span></code></pre></div><h3 id="证书签发" tabindex="-1">证书签发 <a class="header-anchor" href="#证书签发" aria-label="Permalink to &quot;证书签发&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">op</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> read</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;op://&lt;secret reference&gt;&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> intermediates/home_ca_intermediate_1.pem</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> x509</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -req</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -days</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 365</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -sha256</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -extfile</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> clients/neko/2023/client.ext</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -in</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> clients/neko/2023/client.csr</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -CA</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> intermediates/home_ca_intermediate_1.crt</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -CAkey</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> intermediates/home_ca_intermediate_1.pem</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -out</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> clients/neko/2023/client.crt</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -CAcreateserial</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">rm</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -rf</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> intermediates/home_ca_intermediate_1.pem</span></span></code></pre></div><h3 id="创建证书链-bundle" tabindex="-1">创建证书链 bundle <a class="header-anchor" href="#创建证书链-bundle" aria-label="Permalink to &quot;创建证书链 bundle&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">cat</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> home_ca.crt</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> intermediates/home_ca_intermediate_1.crt</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> intermediates/home_ca_intermediate_1_bundle.crt</span></span></code></pre></div><h3 id="用证书链-bundle-来验证证书" tabindex="-1">用证书链 bundle 来验证证书 <a class="header-anchor" href="#用证书链-bundle-来验证证书" aria-label="Permalink to &quot;用证书链 bundle 来验证证书&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> verify</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -CAfile</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> intermediates/home_ca_intermediate_1_bundle.crt</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> clients/neko/2023/client.crt</span></span></code></pre></div><h3 id="验证成功后打包为-p12-格式的文件方便导入导出和安装" tabindex="-1">验证成功后打包为 .p12 格式的文件方便导入导出和安装 <a class="header-anchor" href="#验证成功后打包为-p12-格式的文件方便导入导出和安装" aria-label="Permalink to &quot;验证成功后打包为 .p12 格式的文件方便导入导出和安装&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> pkcs12</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -export</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -in</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> clients/neko/2023/client.crt</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -inkey</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> clients/neko/2023/client.pem</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -certfile</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> intermediates/home_ca_intermediate_1_bundle.crt</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -out</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> clients/neko/2023/neko@ayaka.moe.p12</span></span></code></pre></div><p>成功导入到 KeyStore 里面之后记得删除私钥和证书签发请求文件</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">rm</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -rf</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> clients/neko/2023/client.pem</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">rm</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -rf</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> clients/neko/2023/client.csr</span></span></code></pre></div><h2 id="快速脚本" tabindex="-1">快速脚本 <a class="header-anchor" href="#快速脚本" aria-label="Permalink to &quot;快速脚本&quot;">​</a></h2><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#!/usr/bin/env bash</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">read</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;用户名：&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> USERNAME</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">read</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;邮箱：&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> EMAIL</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">read</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;CA Bundle 名称：&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> INTERMEDIATE_CA_BUNDLE_NAME</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">read</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;中间 CA 证书名：&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> INTERMEDIATE_CA_NAME</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">read</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;1Password CLI CA Secret Reference：&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ONE_PASSWORD_CLI_CA_SECRET_REFERENCE</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">CURRENT_YEAR</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">date</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> +%Y</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;创建用户目录...&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">rm</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -rf</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> clients/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$USERNAME</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$CURRENT_YEAR</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">mkdir</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> clients/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$USERNAME</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$CURRENT_YEAR</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;生成用户私钥...&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> genrsa</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -out</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> clients/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$USERNAME</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$CURRENT_YEAR</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/client.pem</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 4096</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;生成用户证书签发请求文件...&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">cat</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> clients/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$USERNAME</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$CURRENT_YEAR</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/client.cnf</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> &lt;&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;"> EOF</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">[req]</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">prompt = no</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">distinguished_name = req_distinguished_name</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">[req_distinguished_name]</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">C = CN</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">ST = Shanghai</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">L = Shanghai</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">O = Ayaka Home Users</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">OU = Users</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">CN = </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$EMAIL</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">emailAddress = </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$EMAIL</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">EOF</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> req</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -new</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -config</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> clients/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$USERNAME</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$CURRENT_YEAR</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/client.cnf</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -key</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> clients/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$USERNAME</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$CURRENT_YEAR</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/client.pem</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -out</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> clients/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$USERNAME</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$CURRENT_YEAR</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/client.csr</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;创建证书拓展文件...&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">cat</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> clients/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$USERNAME</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$CURRENT_YEAR</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/client.ext</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> &lt;&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;"> EOF</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">basicConstraints = CA:FALSE</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">nsCertType = client, email</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">nsComment = &quot;Ayaka Home Users Certificates&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">subjectKeyIdentifier = hash</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">authorityKeyIdentifier = keyid,issuer</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">keyUsage = critical, nonRepudiation, digitalSignature, keyEncipherment</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">extendedKeyUsage = clientAuth, emailProtection</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">EOF</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;证书签发...&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">op</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> read</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> $ONE_PASSWORD_CLI_CA_SECRET_REFERENCE</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> intermediates/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$INTERMEDIATE_CA_NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">.pem</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> x509</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -req</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -days</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 365</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -sha256</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -extfile</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> clients/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$USERNAME</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$CURRENT_YEAR</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/client.ext</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -in</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> clients/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$USERNAME</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$CURRENT_YEAR</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/client.csr</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -CA</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> intermediates/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$INTERMEDIATE_CA_NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">.crt</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -CAkey</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> intermediates/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$INTERMEDIATE_CA_NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">.pem</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -out</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> clients/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$USERNAME</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$CURRENT_YEAR</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/client.crt</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -CAcreateserial</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">rm</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -rf</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> intermediates/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$INTERMEDIATE_CA_NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">.pem</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;验证证书...&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> verify</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -CAfile</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> intermediates/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$INTERMEDIATE_CA_BUNDLE_NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">.crt</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> clients/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$USERNAME</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$CURRENT_YEAR</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/client.crt</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;打包证书...&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> pkcs12</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -export</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -in</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> clients/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$USERNAME</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$CURRENT_YEAR</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/client.crt</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -inkey</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> clients/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$USERNAME</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$CURRENT_YEAR</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/client.pem</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -certfile</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> intermediates/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$INTERMEDIATE_CA_BUNDLE_NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">.crt</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -out</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> clients/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$USERNAME</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$CURRENT_YEAR</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$EMAIL</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">.p12</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">rm</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -rf</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> clients/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$USERNAME</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$CURRENT_YEAR</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/client.pem</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">rm</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -rf</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> clients/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$USERNAME</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$CURRENT_YEAR</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/client.csr</span></span></code></pre></div>`,19);function y(c,o,E,F,A,u){const n=i("NolebasePageProperties"),h=i("NolebaseGitContributors"),t=i("NolebaseGitChangelog");return r(),e("div",null,[C,s(n),g,s(h),s(t)])}const R=l(d,[["render",y]]);export{m as __pageData,R as default};
