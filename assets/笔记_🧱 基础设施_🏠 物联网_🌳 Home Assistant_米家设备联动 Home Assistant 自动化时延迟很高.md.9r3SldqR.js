import{_ as d,c as _,I as s,j as t,a as e,w as i,au as n,D as o,o as m}from"./chunks/framework.RMxno62p.js";const F=JSON.parse('{"title":"米家设备联动 Home Assistant 自动化时延迟很高","description":"","frontmatter":{"tags":["软件/iOS/Homekit","软件/macOS/Homekit","物联网/智能家居/Homekit","软件/iPadOS/Homekit","开源/软件/Home-Assistant","开源/软件/Home-Assistant/HASS","物联网/智能家居/Home-Assistant","物联网/智能家居/Home-Assistant/HASS","物联网/智能家居/生态/米家","物联网/智能家居/生态/Homekit","物联网","物联网/IoT"],"status":"尚未完成"},"headers":[],"relativePath":"笔记/🧱 基础设施/🏠 物联网/🌳 Home Assistant/米家设备联动 Home Assistant 自动化时延迟很高.md","filePath":"笔记/🧱 基础设施/🏠 物联网/🌳 Home Assistant/米家设备联动 Home Assistant 自动化时延迟很高.md"}'),c={name:"笔记/🧱 基础设施/🏠 物联网/🌳 Home Assistant/米家设备联动 Home Assistant 自动化时延迟很高.md"},u=t("h1",{id:"米家设备联动-home-assistant-自动化时延迟很高",tabindex:"-1"},[e("米家设备联动 Home Assistant 自动化时延迟很高 "),t("a",{class:"header-anchor",href:"#米家设备联动-home-assistant-自动化时延迟很高","aria-label":'Permalink to "米家设备联动 Home Assistant 自动化时延迟很高"'},"​")],-1),f=t("div",{class:"warning custom-block github-alert"},[t("p",{class:"custom-block-title"},"WARNING"),t("p",null,"⚠️ 该文档尚未完成，仍在编写中...")],-1),p=t("h2",{id:"说明",tabindex:"-1"},[e("说明 "),t("a",{class:"header-anchor",href:"#说明","aria-label":'Permalink to "说明"'},"​")],-1),b=t("h2",{id:"哪里来的延迟",tabindex:"-1"},[e("哪里来的延迟 "),t("a",{class:"header-anchor",href:"#哪里来的延迟","aria-label":'Permalink to "哪里来的延迟"'},"​")],-1),k=t("sup",{class:"footnote-ref"},[t("a",{href:"#fn1",id:"fnref1"},"[1]")],-1),g=t("h2",{id:"解决方法一-直接改配置来缩短轮询间隔",tabindex:"-1"},[e("解决方法一：直接改配置来缩短轮询间隔 "),t("a",{class:"header-anchor",href:"#解决方法一-直接改配置来缩短轮询间隔","aria-label":'Permalink to "解决方法一：直接改配置来缩短轮询间隔"'},"​")],-1),A=t("code",null,"interval_seconds",-1),H=n(`<div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># customize.yaml</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">sensor.your_entity_id</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">  interval_seconds</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">10</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> # 轮询间隔时长(秒)</span></span></code></pre></div><p>所以这意味着你可以在 HASS 里面的 File Editor 去修改并进行配置。不过这样的方式依然有限制：</p><blockquote><p>一般情况下，对于开关、灯、环境传感器等设备，我们推荐使用默认轮询时长即可，过于频繁的请求状态可能会使设备负载过高，且大部分请求是无意义的。</p><p>对于人体传感器、门磁、无线开关类设备，它们的状态通常为瞬时状态(即：事件)，部分型号支持获取最后一次事件触发的时间，且默认轮询时长为 15 秒，对于无法获取最后触发事件的设备，即使修改轮询时间到 1 秒，也可能无法获取正确的状态。</p></blockquote>`,3),y=t("strong",null,"此类设备通过本插件集成后不太推荐用于触发实时自动化，仅适合作为如几分钟无人移动关灯这类自动化的条件",-1),P=t("h2",{id:"解决方法二-多模网关搭配-home-assistant-集成",tabindex:"-1"},[e("解决方法二：多模网关搭配 Home Assistant 集成 "),t("a",{class:"header-anchor",href:"#解决方法二-多模网关搭配-home-assistant-集成","aria-label":'Permalink to "解决方法二：多模网关搭配 Home Assistant 集成"'},"​")],-1),x=n('<table tabindex="0"><thead><tr><th>类型</th><th>介绍</th></tr></thead><tbody><tr><td>推测状态 Assumed State</td><td>无法获取状态，只能根据最后的指令推测、假定。</td></tr><tr><td>云端轮询 Cloud Polling</td><td>Home Assistant 定时向云端查询状态，所以互联网连接必须得到保证，至少要在轮询发起前建立连接。同时轮询意味着状态刷新必然会有明显的延迟（主要是轮询周期，其次通讯时延、服务器响应时延等）。</td></tr><tr><td>云端推送 Cloud Push</td><td>云端服务器在状态变化时向 Home Assistant 推送通知，这要求互联网连接必须一直保持。显然这种方式比轮询更加高效，时延也会更短。</td></tr><tr><td>本地轮询 Local Polling</td><td>提供与设备的直接通信。轮询状态意味着稍后可能会注意到更新。</td></tr><tr><td>本地推送 Local Push</td><td>提供与设备的直接通信。一旦有新状态，Home Assistant 就会收到通知。</td></tr></tbody></table><p>如何消除这个延迟呢？</p><h2 id="参考资料" tabindex="-1">参考资料 <a class="header-anchor" href="#参考资料" aria-label="Permalink to &quot;参考资料&quot;">​</a></h2>',3),w=t("h2",{id:"延伸阅读",tabindex:"-1"},[e("延伸阅读 "),t("a",{class:"header-anchor",href:"#延伸阅读","aria-label":'Permalink to "延伸阅读"'},"​")],-1),C=t("hr",{class:"footnotes-sep"},null,-1),T={class:"footnotes"},S={class:"footnotes-list"},N={id:"fn1",class:"footnote-item"},v=t("a",{href:"#fnref1",class:"footnote-backref"},"↩︎",-1);function I(E,G,B,V,X,D){const l=o("NolebasePageProperties"),a=o("VPNolebaseInlineLinkPreview"),r=o("NolebaseGitContributors"),h=o("NolebaseGitChangelog");return m(),_("div",null,[u,s(l),f,p,t("p",null,[e("最近小音 @LittleSound 在 Home Assistant 和 Homekit 上给从 Home Assistant 从米家接入的"),s(a,{href:"https://zhuanlan.zhihu.com/p/592187536",target:"_blank",rel:"noreferrer"},{default:i(()=>[e("子擎的人在传感器")]),_:1}),e("做了一些关于自动开关灯的场景的自动化，然后发现从设备的状态更新，到触发 Home Assistant 的自动化，到 Homekit 灯具开关的流程耗时非常长，可能有 5s 到 10s 不等的延迟。")]),b,t("p",null,[e("直到后来查资料才知道这是因为我们 Home Assistant 中通过 HACS 配置安装的 "),s(a,{href:"https://github.com/al-one/hass-xiaomi-miot",target:"_blank",rel:"noreferrer"},{default:i(()=>[e("Xiaomi Miot Auto")]),_:1}),e(" 目前主要是通过轮询的方式获取设备状态，通俗的讲就是每隔几十秒去刷新一次状态。"),k]),g,t("p",null,[e("不过，"),s(a,{href:"https://github.com/al-one/hass-xiaomi-miot",target:"_blank",rel:"noreferrer"},{default:i(()=>[e("Xiaomi Miot Auto")]),_:1}),e(" 是提供了配置方案的，允许用户修改这个轮询间隔长度：")]),t("blockquote",null,[t("p",null,[e("在 Token 方式集成时，这个时长是可以直接修改的(添加集成和修改集成选项均可)，目前默认是 30 秒。 而通过账号集成时，由于一个集成配置会对应多个设备，因此无法统一配置，需要为每个设备实体添加"),s(a,{href:"https://github.com/al-one/hass-xiaomi-miot/issues/100#issuecomment-864678774",target:"_blank",rel:"noreferrer"},{default:i(()=>[e("自定义属性")]),_:1}),e(),A,e(" 来修改轮询时长：")])]),H,t("p",null,[s(a,{href:"https://github.com/al-one/hass-xiaomi-miot",target:"_blank",rel:"noreferrer"},{default:i(()=>[e("Xiaomi Miot Auto")]),_:1}),e(" 的作者也提到说：")]),t("blockquote",null,[t("p",null,[y,e("，如果需要实时更新状态，推荐使用"),s(a,{href:"https://home.miot-spec.com/s/lumi.gateway.mgl03",target:"_blank",rel:"noreferrer"},{default:i(()=>[e("多模网关")]),_:1}),e("配合"),s(a,{href:"https://github.com/AlexxIT/XiaomiGateway3",target:"_blank",rel:"noreferrer"},{default:i(()=>[e("XiaomiGateway3")]),_:1}),e("集成。")])]),t("p",null,[e("那为什么是轮询呢？可以是轮询之外的别的方案吗？"),s(a,{href:"https://github.com/al-one/hass-xiaomi-miot",target:"_blank",rel:"noreferrer"},{default:i(()=>[e("Xiaomi Miot Auto")]),_:1}),e(" 的作者提到的这个多模网关可以解决这个问题吗？")]),P,t("p",null,[e("想回答这个问题这要提到 Home Assistant 文档中科普的"),s(a,{href:"https://www.home-assistant.io/blog/2016/02/12/classifying-the-internet-of-things/#classifiers",target:"_blank",rel:"noreferrer"},{default:i(()=>[e("物联网智能家居设备的几种类型")]),_:1}),e("：")]),x,t("ul",null,[t("li",null,[s(a,{href:"https://bbs.hassbian.com/thread-14225-1-1.html",target:"_blank",rel:"noreferrer"},{default:i(()=>[e("【新手必读】入门->精通：HA安装方式、基本概念及来龙去脉 - 『HomeAssistant』新手入门区 - 『瀚思彼岸』» 智能家居技术论坛 - Powered by Discuz!")]),_:1})]),t("li",null,[s(a,{href:"https://www.home-assistant.io/blog/2016/02/12/classifying-the-internet-of-things/#classifiers",target:"_blank",rel:"noreferrer"},{default:i(()=>[e("Classifying the Internet of Things - Home Assistant")]),_:1})]),t("li",null,[s(a,{href:"https://github.com/al-one/hass-xiaomi-miot/issues/100#issuecomment-909031222",target:"_blank",rel:"noreferrer"},{default:i(()=>[e("FAQ - 常见问题 · Issue #100 · al-one/hass-xiaomi-miot")]),_:1})])]),w,t("ul",null,[t("li",null,[s(a,{href:"https://github.com/AlexxIT/XiaomiGateway3#how-it-works",target:"_blank",rel:"noreferrer"},{default:i(()=>[e("AlexxIT/XiaomiGateway3: Control Zigbee, BLE and Mesh devices from Home Assistant with Xiaomi Gateway 3 on original firmware")]),_:1})]),t("li",null,[s(a,{href:"https://www.zigbee2mqtt.io/guide/getting-started/#installation",target:"_blank",rel:"noreferrer"},{default:i(()=>[e("Getting started | Zigbee2MQTT")]),_:1})])]),s(r),s(h),C,t("section",T,[t("ol",S,[t("li",N,[t("p",null,[e("在 "),s(a,{href:"https://github.com/al-one/hass-xiaomi-miot/issues/100#issuecomment-909031222",target:"_blank",rel:"noreferrer"},{default:i(()=>[e("为什么设备状态会有延迟？如何减小延迟？")]),_:1}),e(" 中提及：延迟通常是指通过米家APP或物理按键等操作设备后，设备在HA中的实体状态要等几秒甚至十几秒后才会更新。原因是本插件目前主要是通过轮询的方式获取设备状态，通俗的讲就是每隔几十秒去刷新一次状态。现在这个时间是 30s。 "),v])])])])])}const L=d(c,[["render",I]]);export{F as __pageData,L as default};
