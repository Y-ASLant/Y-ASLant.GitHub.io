import{_ as h,c as l,I as s,j as a,a as p,au as k,D as i,o}from"./chunks/framework.RMxno62p.js";const b=JSON.parse('{"title":"2023 年轮替 ihome.cat 证书","description":"","frontmatter":{"tags":["数学/密码学/证书/TLS","数学/密码学/证书/TLS/HTTPS","数学/密码学/证书/TLS/SSL","数学/密码学/证书/PKI","命令行/openssl"]},"headers":[],"relativePath":"笔记/🔒 PKI 公钥基础设施/证书维护和轮替/记录/2023 年轮替 ihome.cat 证书.md","filePath":"笔记/🔒 PKI 公钥基础设施/证书维护和轮替/记录/2023 年轮替 ihome.cat 证书.md"}'),r={name:"笔记/🔒 PKI 公钥基础设施/证书维护和轮替/记录/2023 年轮替 ihome.cat 证书.md"},d=a("h1",{id:"_2023-年轮替-ihome-cat-证书",tabindex:"-1"},[p("2023 年轮替 ihome.cat 证书 "),a("a",{class:"header-anchor",href:"#_2023-年轮替-ihome-cat-证书","aria-label":'Permalink to "2023 年轮替 ihome.cat 证书"'},"​")],-1),c=k(`<p>Gateway 那边 Intermediate CA 的流程和系统还没有建立起来，继续先用 Root CA 签发证书。</p><p>这次维护用了 1Password 帮忙存储和读取 key，不过生成 Private key 的功能尚在 beta 阶段，所以还是先用 openssl 生成。</p><h3 id="生成-private-key-和证书签发请求文件" tabindex="-1">生成 Private key 和证书签发请求文件 <a class="header-anchor" href="#生成-private-key-和证书签发请求文件" aria-label="Permalink to &quot;生成 Private key 和证书签发请求文件&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> genrsa</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -out</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ./domains/ihome.cat/2023/ihome.cat.pem</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 4096</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> req</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -new</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -key</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> domains/ihome.cat/2023/ihome.cat.pem</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -out</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> domains/ihome.cat/2023/ihome.cat.csr</span></span></code></pre></div><h3 id="创建证书拓展文件" tabindex="-1">创建证书拓展文件 <a class="header-anchor" href="#创建证书拓展文件" aria-label="Permalink to &quot;创建证书拓展文件&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> cat</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> domains/ihome.cat/2023/ihome.cat.ext</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> &lt;&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;"> EOF</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">authorityKeyIdentifier=keyid,issuer</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">basicConstraints=CA:FALSE</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">keyUsage = digitalSignature, nonRepudiation, keyEncipherment, dataEncipherment</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">subjectAltName = @alt_names</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">[alt_names]</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">DNS.1 = *.ihome.cat</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">DNS.2 = ihome.cat</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">EOF</span></span></code></pre></div><h3 id="使用根证书颁发机构对证书进行签发" tabindex="-1">使用根证书颁发机构对证书进行签发 <a class="header-anchor" href="#使用根证书颁发机构对证书进行签发" aria-label="Permalink to &quot;使用根证书颁发机构对证书进行签发&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">op</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> read</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;op://&lt;secret reference&gt;&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> home_ca.pem</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> x509</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -req</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -in</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> domains/ihome.cat/2023/ihome.cat.csr</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -CA</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> home_ca.crt</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -CAkey</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> home_ca.pem</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -CAcreateserial</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -out</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> domains/ihome.cat/2023/ihome.cat.crt</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -days</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 365</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -sha256</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -extfile</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> domains/ihome.cat/2023/ihome.cat.ext</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">rm</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -rf</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> home_ca.pem</span></span></code></pre></div><h3 id="验证证书" tabindex="-1">验证证书 <a class="header-anchor" href="#验证证书" aria-label="Permalink to &quot;验证证书&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> verify</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -CAfile</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> home_ca.crt</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> domains/ihome.cat/2023/ihome.cat.crt</span></span></code></pre></div><p>然后把证书部署到对应的服务端即可。</p><p>部署后记得清理本地的私钥和证书申请文件。</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">rm</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -rf</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> domains/ihome.cat/2023/ihome.cat.pem</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">rm</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -rf</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> domains/ihome.cat/2023/ihome.cat.csr</span></span></code></pre></div>`,13);function g(C,m,y,F,_,A){const e=i("NolebasePageProperties"),t=i("NolebaseGitContributors"),n=i("NolebaseGitChangelog");return o(),l("div",null,[d,s(e),c,s(t),s(n)])}const v=h(r,[["render",g]]);export{b as __pageData,v as default};
