import{_ as p,c as d,I as s,j as a,a as h,w as r,au as t,D as i,o as g}from"./chunks/framework.RMxno62p.js";const v=JSON.parse('{"title":"OpenSSL 通过指定的证书吊销列表手动验证证书有效性","description":"","frontmatter":{"tags":["命令行/openssl","数学/密码学/证书/TLS","数学/密码学/证书/TLS/SSL","数学/密码学/证书/证书机构/CA","数学/密码学/证书","数学/密码学/证书/证书吊销列表","数学/密码学/证书/证书吊销列表/CRL"]},"headers":[],"relativePath":"笔记/🔒 PKI 公钥基础设施/TLS 传输层安全/OpenSSL 通过指定的证书吊销列表手动验证证书有效性.md","filePath":"笔记/🔒 PKI 公钥基础设施/TLS 传输层安全/OpenSSL 通过指定的证书吊销列表手动验证证书有效性.md"}'),o={name:"笔记/🔒 PKI 公钥基础设施/TLS 传输层安全/OpenSSL 通过指定的证书吊销列表手动验证证书有效性.md"},C=a("h1",{id:"openssl-通过指定的证书吊销列表手动验证证书有效性",tabindex:"-1"},[h("OpenSSL 通过指定的证书吊销列表手动验证证书有效性 "),a("a",{class:"header-anchor",href:"#openssl-通过指定的证书吊销列表手动验证证书有效性","aria-label":'Permalink to "OpenSSL 通过指定的证书吊销列表手动验证证书有效性"'},"​")],-1),c=t('<h5 id="文档版本" tabindex="-1">文档版本 <a class="header-anchor" href="#文档版本" aria-label="Permalink to &quot;文档版本&quot;">​</a></h5><table tabindex="0"><thead><tr><th>编辑者</th><th>版本</th><th>变更日期</th><th>变更说明</th></tr></thead><tbody><tr><td>Neko</td><td>v1.0.0</td><td>2021-12-02</td><td></td></tr></tbody></table><h3 id="文档兼容性" tabindex="-1">文档兼容性 <a class="header-anchor" href="#文档兼容性" aria-label="Permalink to &quot;文档兼容性&quot;">​</a></h3><table tabindex="0"><thead><tr><th>主体</th><th>版本号</th><th>文档地址（如果有）</th></tr></thead><tbody><tr><td>OpenSSL</td><td>LibreSSL 2.8.3</td><td>无</td></tr></tbody></table>',4),y=t(`<h2 id="验证步骤" tabindex="-1">验证步骤 <a class="header-anchor" href="#验证步骤" aria-label="Permalink to &quot;验证步骤&quot;">​</a></h2><h3 id="获取网站的-https-ssl-证书" tabindex="-1">获取网站的 HTTPS SSL 证书 <a class="header-anchor" href="#获取网站的-https-ssl-证书" aria-label="Permalink to &quot;获取网站的 HTTPS SSL 证书&quot;">​</a></h3><p>该步骤通过 <code>openssl</code> 命令和 <code>wikipedia.org:443</code> 创建了一个连接，并且把证书文件输出到名为 <code>wikipedia.pem</code> 的文件中</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> s_client</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -connect</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> wikipedia.org:443</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> 2&gt;&amp;1</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /dev/null</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> sed</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;/-----BEGIN/,/-----END/p&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> wikipedia.pem</span></span></code></pre></div><h3 id="获取上一步获取证书所关联的-crl-文件的-url" tabindex="-1">获取上一步获取证书所关联的 CRL 文件的 URL <a class="header-anchor" href="#获取上一步获取证书所关联的-crl-文件的-url" aria-label="Permalink to &quot;获取上一步获取证书所关联的 CRL 文件的 URL&quot;">​</a></h3><p>该步骤通过 <code>openssl</code> 命令读取上一步中获取的 <code>wikipedia.pem</code> 文件，并且使用 <code>grep</code> 命令查找了 <code>X509v3 CRL Distribution Points</code> 字段，打印它所相关的 4 行内的值</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> x509</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -noout</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -text</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -in</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> wikipedia.pem</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -A</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 4</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;X509v3 CRL Distribution Points&#39;</span></span></code></pre></div><p>示例输出</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">X509v3</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> CRL</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Distribution</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Points:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    Full</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Name:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">      URI:http://crl.globalsign.com/gs/gsorganizationvalsha2g2.crl</span></span></code></pre></div><h3 id="通过-crl-文件的-url-获取-crl-文件" tabindex="-1">通过 CRL 文件的 URL 获取 CRL 文件 <a class="header-anchor" href="#通过-crl-文件的-url-获取-crl-文件" aria-label="Permalink to &quot;通过 CRL 文件的 URL 获取 CRL 文件&quot;">​</a></h3><p>该步骤通过 <code>wget</code> 命令通过上一步获取的 URL 下载了一个文件，并且保存为 <code>crl.der</code>（<code>.der</code> 拓展名表示该文件使用 DER 编码）</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">wget</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -O</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> crl.der</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> http://crl.globalsign.com/gs/gsorganizationvalsha2g2.crl</span></span></code></pre></div><h3 id="转换下载的-crl-文件编码格式为-pem" tabindex="-1">转换下载的 CRL 文件编码格式为 PEM <a class="header-anchor" href="#转换下载的-crl-文件编码格式为-pem" aria-label="Permalink to &quot;转换下载的 CRL 文件编码格式为 PEM&quot;">​</a></h3><p>手动下载的 CRL 证书吊销列表文件使用 DER 编码，需要预先转换为统一的 PEM 格式：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> crl</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -inform</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> DER</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -in</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">CRL</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 文件路</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">径</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -out</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">转换后的</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> CRL</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 文件路径（使用</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> pem</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 作为拓展名</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">）</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -outform</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> PEM</span></span></code></pre></div><p>此处可以执行下面的命令把上一步的 CRL 文件转换为 PEM 编码：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> crl</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -inform</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> DER</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -in</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> crl.der</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -outform</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> PEM</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -out</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> crl.pem</span></span></code></pre></div><h3 id="获取网站-https-ssl-的证书链" tabindex="-1">获取网站 HTTPS SSL 的证书链 <a class="header-anchor" href="#获取网站-https-ssl-的证书链" aria-label="Permalink to &quot;获取网站 HTTPS SSL 的证书链&quot;">​</a></h3><p>HTTPS 使用的 SSL 证书通常由证书颁发机构颁发，有的证书基础设施可能还会使用『中间证书颁发机构』来辅助管理证书的颁发和吊销过程，此处我们需要了解网站的 HTTPS SSL 证书都包含了哪些证书链（即可能的上游证书颁发机构，可能有一个或是更多个）</p><p>输入下面的命令就可以获得证书链的文件 <code>chain.pem</code></p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">OLDIFS</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$IFS</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">IFS</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;:&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> certificates</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> s_client</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -connect</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">网站域</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">名</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">:</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">HTTPS</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 服务所在的端</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">口</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -showcerts</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -tlsextdebug</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -tls1</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> 2&gt;&amp;1</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/dev/null</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> sed</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;/-----BEGIN/,/-----END/ {/-----BEGIN/ s/^/:/; p}&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> certificate</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> in</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> \${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">certificates</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">#:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}; </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">do</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;"> echo</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> $certificate</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> tee</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -a</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> chain.pem</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ; </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">done</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">IFS</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$OLDIFS</span></span></code></pre></div><p>此处可以执行下面的命令获得证书链的文件 <code>chain.pem</code>：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">OLDIFS</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$IFS</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">IFS</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;:&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> certificates</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> s_client</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -connect</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> wikipedia.org:443</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -showcerts</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -tlsextdebug</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -tls1</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> 2&gt;&amp;1</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/dev/null</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> sed</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;/-----BEGIN/,/-----END/ {/-----BEGIN/ s/^/:/; p}&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> certificate</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> in</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> \${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">certificates</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">#:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}; </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">do</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;"> echo</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> $certificate</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> tee</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -a</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> chain.pem</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ; </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">done</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">IFS</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$OLDIFS</span></span></code></pre></div><p>在该证书中，会包含（如果有的话）上游的证书颁发机构的证书信息，以及这些证书的公钥文件。</p><h3 id="把-pem-编码的证书链文件和-pem-编码的-crl-证书吊销列表-文件拼接到一起" tabindex="-1">把 PEM 编码的证书链文件和 PEM 编码的 CRL（证书吊销列表）文件拼接到一起 <a class="header-anchor" href="#把-pem-编码的证书链文件和-pem-编码的-crl-证书吊销列表-文件拼接到一起" aria-label="Permalink to &quot;把 PEM 编码的证书链文件和 PEM 编码的 CRL（证书吊销列表）文件拼接到一起&quot;">​</a></h3><p>Openssl 命令需要将 PEM 格式的证书链和 CRL 连接在一起以进行验证。检查证书是否有效的时候可以省略 CRL 文件，但是 CRL 检查将不起作用，它只会根据证书链验证证书（比如验证该证书是否是颁发机构颁发的，或是是否还在有效期、是否被篡改等）。</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">cat</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> chain.pem</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> crl.pem</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> crl_chain.pem</span></span></code></pre></div><h3 id="验证" tabindex="-1">验证 <a class="header-anchor" href="#验证" aria-label="Permalink to &quot;验证&quot;">​</a></h3><h4 id="验证未被吊销的证书" tabindex="-1">验证未被吊销的证书 <a class="header-anchor" href="#验证未被吊销的证书" aria-label="Permalink to &quot;验证未被吊销的证书&quot;">​</a></h4><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> verify</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -crl_check</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -CAfile</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> crl_chain.pem</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> wikipedia.pem</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">wikipedia.pem:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> OK</span></span></code></pre></div><p>以上就是通过的情况，会显示 <code>OK</code></p><h4 id="验证被吊销的证书" tabindex="-1">验证被吊销的证书 <a class="header-anchor" href="#验证被吊销的证书" aria-label="Permalink to &quot;验证被吊销的证书&quot;">​</a></h4><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> verify</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -crl_check</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -CAfile</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> crl_chain.pem</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> revoked-test.pem</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">revoked-test.pem:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> OU</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Domain</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Control</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Validated,</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> OU</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> PositiveSSL,</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> CN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> xs4all.nl</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 23</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> at</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> depth</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> lookup:certificate</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> revoked</span></span></code></pre></div><p>以上就是未通过的情况，显示 <code>certificate revoked</code>（证书已被吊销）</p><h2 id="特殊情况" tabindex="-1">特殊情况 <a class="header-anchor" href="#特殊情况" aria-label="Permalink to &quot;特殊情况&quot;">​</a></h2><p>手动下载的 CRL 证书吊销列表文件使用 DER 编码，需要预先转换为统一的 PEM 格式：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> crl</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -inform</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> DER</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -in</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">CRL</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 文件路</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">径</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -out</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">转换后的</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> CRL</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 文件路径（使用</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> pem</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 作为拓展名</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">）</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -outform</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> PEM</span></span></code></pre></div><p>手动下载的 CER、CRT 证书文件使用 DER 编码，需要预先转换为统一的 PEM 格式方便操作：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> x509</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -in</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">CER/CRT</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 文件路</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">径</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -inform</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> DER</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -out</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">转换后的</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> CER/CRT</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 文件路</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">径</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -outform</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> PEM</span></span></code></pre></div>`,39);function F(B,A,D,E,u,b){const l=i("NolebasePageProperties"),e=i("VPNolebaseInlineLinkPreview"),n=i("NolebaseGitContributors"),k=i("NolebaseGitChangelog");return g(),d("div",null,[C,s(l),c,a("p",null,[h("原文："),s(e,{href:"https://raymii.org/s/articles/OpenSSL_manually_verify_a_certificate_against_a_CRL.html",target:"_blank",rel:"noreferrer"},{default:r(()=>[h("OpenSSL: 通过指定的 CRL（证书吊销列表）手动验证证书有效性 - Raymii.org - 英文")]),_:1})]),y,s(n),s(k)])}const _=p(o,[["render",F]]);export{v as __pageData,_ as default};
