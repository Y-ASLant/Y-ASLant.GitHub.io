import{_ as l,c as e,I as s,j as a,a as p,au as k,D as i,o as r}from"./chunks/framework.RMxno62p.js";const _=JSON.parse('{"title":"CORS 重定向问题","description":"","frontmatter":{"tags":["开发/后端/跨域","计算机/网络/网关/Nginx","计算机/网络/跨域/CORS"]},"headers":[],"relativePath":"笔记/🛠️ 开发/CORS 重定向问题.md","filePath":"笔记/🛠️ 开发/CORS 重定向问题.md"}'),d={name:"笔记/🛠️ 开发/CORS 重定向问题.md"},B=a("h1",{id:"cors-重定向问题",tabindex:"-1"},[p("CORS 重定向问题 "),a("a",{class:"header-anchor",href:"#cors-重定向问题","aria-label":'Permalink to "CORS 重定向问题"'},"​")],-1),g=k(`<h5 id="文档版本" tabindex="-1">文档版本 <a class="header-anchor" href="#文档版本" aria-label="Permalink to &quot;文档版本&quot;">​</a></h5><table tabindex="0"><thead><tr><th>编辑者</th><th>版本</th><th>变更日期</th><th>变更说明</th></tr></thead><tbody><tr><td>Neko</td><td>v1.0.0</td><td>2022-07-20</td><td>创建</td></tr></tbody></table><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        listen </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">80</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        server_name </span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">mydomain;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 301</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> https://$</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">host</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">$</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">request_uri</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        listen </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">443</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ssl http2;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        server_name </span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">mydomain;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        ssl_certificate </span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">/etc/ssl/certs/mydomain/fullchain.pem;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        ssl_certificate_key </span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">/etc/ssl/private/mydomain/privkey.pem;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        ssl_prefer_server_ciphers </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        ssl_protocols </span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">TLSv1 TLSv1.1 TLSv1.2 TLSv1.3;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        ssl_ciphers </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;EECDH+ECDSA+AESGCM EECDH+aRSA+AESGCM EECDH+ECDSA+SHA384 EECDH+ECDSA+SHA256 EECDH+aRSA+SHA384 EECDH+aRSA+SHA256 EECDH+aRSA+RC4 EECDH EDH+aRSA !aNULL !eNULL !LOW !3DES !MD5 !EXP !PSK !SRP !DSS !RC4&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        ssl_session_cache </span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">shared:SSL:10m;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        ssl_session_timeout </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">10m</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#ABB2BF;"> /api/ </span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ($</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">request_method</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;OPTIONS&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            add_header </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;Access-Control-Allow-Origin&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;https://mydomain&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            add_header </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;Access-Control-Allow-Credentials&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;true&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            add_header </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;Access-Control-Allow-Methods&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;GET, POST, PUT, PATCH, DELETE, HEAD&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            add_header </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;Access-Control-Allow-Headers&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;Origin, Content-Length, Content-Type, Credential, Cookie, Authorization, X-Accept-Language-Code, X-HTTP-Method-Override&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            add_header </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;Access-Control-Max-Age&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1728000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># CORS preflight is valid for 20 days</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            add_header </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;Content-Type&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;text/plain charset=UTF-8&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            add_header </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;Content-Length&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># no content transferred</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            return</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 204</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        client_max_body_size </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">200m</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        proxy_set_header </span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">X-Forwarded-For $</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">remote_addr</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        proxy_set_header </span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">X-Real-IP $</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">remote_addr</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        proxy_set_header </span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">Host $</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">http_host</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        proxy_redirect </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">off</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        proxy_pass </span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">http://&lt;K8S API service srv Domain&gt;:&lt;ServicePort&gt;;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#ABB2BF;"> /site.webmanifest </span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        proxy_pass </span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">http://&lt;K8S SSR frontend service srv Domain&gt;:&lt;ServicePort&gt;;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#ABB2BF;"> /sw.js </span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        proxy_pass </span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">http://&lt;K8S SSR frontend service srv Domain&gt;:&lt;ServicePort&gt;;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#ABB2BF;"> / </span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 301</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> https://$</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">host</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">$</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">request_uri</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div>`,3);function y(o,D,A,c,C,E){const n=i("NolebasePageProperties"),t=i("NolebaseGitContributors"),h=i("NolebaseGitChangelog");return r(),e("div",null,[B,s(n),g,s(t),s(h)])}const S=l(d,[["render",y]]);export{_ as __pageData,S as default};
