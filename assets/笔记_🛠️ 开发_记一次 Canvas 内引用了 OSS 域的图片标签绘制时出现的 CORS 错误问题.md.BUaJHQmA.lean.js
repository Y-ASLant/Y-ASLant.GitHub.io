import{_ as d,c as p,I as t,j as e,a as s,w as o,au as l,D as n,o as _}from"./chunks/framework.RMxno62p.js";const u="/assets/canvas-referenced-oss-cross-origin-image-as-source-img-element-caused-cors-error-record-screenshot-01.BXWdqQQh.png",ee=JSON.parse('{"title":"è®°ä¸€æ¬¡ Canvas å†…å¼•ç”¨äº† OSS åŸŸçš„å›¾ç‰‡æ ‡ç­¾ç»˜åˆ¶æ—¶å‡ºç°çš„ CORS é”™è¯¯é—®é¢˜","description":"","frontmatter":{"tags":["å¼€å‘/å‰ç«¯","è®¡ç®—æœº/ç½‘ç»œ/è·¨åŸŸ","è®¡ç®—æœº/ç½‘ç»œ/è·¨åŸŸ/CORS","å¼€å‘/æ ‡è®°è¯­è¨€/HTML","å¼€å‘/æ ‡è®°è¯­è¨€/HTML/Canvas","åŸºç¡€è®¾æ–½/å­˜å‚¨/å¯¹è±¡å­˜å‚¨/é˜¿é‡Œäº‘/OSS","åŸºç¡€è®¾æ–½/äº‘æœåŠ¡å•†/é˜¿é‡Œäº‘/Aliyun"]},"headers":[],"relativePath":"ç¬”è®°/ğŸ› ï¸ å¼€å‘/è®°ä¸€æ¬¡ Canvas å†…å¼•ç”¨äº† OSS åŸŸçš„å›¾ç‰‡æ ‡ç­¾ç»˜åˆ¶æ—¶å‡ºç°çš„ CORS é”™è¯¯é—®é¢˜.md","filePath":"ç¬”è®°/ğŸ› ï¸ å¼€å‘/è®°ä¸€æ¬¡ Canvas å†…å¼•ç”¨äº† OSS åŸŸçš„å›¾ç‰‡æ ‡ç­¾ç»˜åˆ¶æ—¶å‡ºç°çš„ CORS é”™è¯¯é—®é¢˜.md"}'),g={name:"ç¬”è®°/ğŸ› ï¸ å¼€å‘/è®°ä¸€æ¬¡ Canvas å†…å¼•ç”¨äº† OSS åŸŸçš„å›¾ç‰‡æ ‡ç­¾ç»˜åˆ¶æ—¶å‡ºç°çš„ CORS é”™è¯¯é—®é¢˜.md"},k=e("h1",{id:"è®°ä¸€æ¬¡-canvas-å†…å¼•ç”¨äº†-oss-åŸŸçš„å›¾ç‰‡æ ‡ç­¾ç»˜åˆ¶æ—¶å‡ºç°çš„-cors-é”™è¯¯é—®é¢˜",tabindex:"-1"},[s("è®°ä¸€æ¬¡ Canvas å†…å¼•ç”¨äº† OSS åŸŸçš„å›¾ç‰‡æ ‡ç­¾ç»˜åˆ¶æ—¶å‡ºç°çš„ CORS é”™è¯¯é—®é¢˜ "),e("a",{class:"header-anchor",href:"#è®°ä¸€æ¬¡-canvas-å†…å¼•ç”¨äº†-oss-åŸŸçš„å›¾ç‰‡æ ‡ç­¾ç»˜åˆ¶æ—¶å‡ºç°çš„-cors-é”™è¯¯é—®é¢˜","aria-label":'Permalink to "è®°ä¸€æ¬¡ Canvas å†…å¼•ç”¨äº† OSS åŸŸçš„å›¾ç‰‡æ ‡ç­¾ç»˜åˆ¶æ—¶å‡ºç°çš„ CORS é”™è¯¯é—®é¢˜"'},"â€‹")],-1),A=l("",6),f=e("code",null,"Access-Control-Allow-Origin: *",-1),C=e("code",null,"useCORS: true",-1),S=l("",11),v=e("code",null,"<img>",-1),m=e("code",null,"crossorigin",-1),O=l("",4),b=l("",9),y=e("strong",null,[e("code",null,"<img>"),s(" æ ‡ç­¾èƒ½å¤ŸåŠ  crossorigin å±æ€§æ¥å¼ºåˆ¶ CORSï¼Œé‚£ CSS é‡Œé¢çš„å›¾ç‰‡æ€ä¹ˆåŠï¼Ÿ")],-1),B=e("p",null,"æ„æ€æ˜¯è¯´ï¼š",-1),w=e("blockquote",null,[e("p",null,[s("åœ¨åšäº†ä¸€äº›ç ”ç©¶ä¹‹åï¼Œæˆ‘ç¡®å®šçœŸæ­£çš„é—®é¢˜æ˜¯å³ä½¿å°† Amazon S3 é…ç½®ä¸ºæ”¯æŒ CORS çš„æƒ…å†µä¸‹ï¼ŒAmazon S3 ä¾ç„¶æ²¡æœ‰"),e("strong",null,'è‡ªåŠ¨è®¾ç½® "Vary:Origin "å¤´'),s("ã€‚å¦‚æœæœ‰äººçŸ¥é“å¦‚ä½•è®©S3åšåˆ°è¿™ä¸€ç‚¹ï¼Œé‚£ä¹Ÿå°†æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ç­”æ¡ˆã€‚")])],-1),P=e("p",null,[s("å’¦ï¼Œè¿™ä¸ª "),e("code",null,"Vary: Origin"),s(" çœ‹èµ·æ¥éå¸¸çœ¼ç†Ÿï¼Œä¹‹å‰åœ¨ OSS çš„è·¨åŸŸé…ç½®ä¸­çœ‹åˆ°è¿‡ï¼Œä½†æ˜¯ä»æœªä»”ç»†äº†è§£è¿‡å…·ä½“çš„å«ä¹‰ã€‚ä½†æ˜¯æˆ‘ä»¬èƒ½åœ¨å¦ä¸€ä¸ªå›ç­”ä¸­èƒ½æ‰¾åˆ°äº›è®¸çº¿ç´¢ï¼š")],-1),T=e("code",null,"Access-Control-Allow-Origin",-1),q=e("code",null,"Vary: Origin",-1),R=e("code",null,"Access-Control-Allow-Origin",-1),D=e("p",null,"å…¶å«ä¹‰æ˜¯ï¼š",-1),E=e("blockquote",null,[e("p",null,[s("æ˜¯çš„ï¼Œå¦‚æœä¸€ä¸ªè¯·æ±‚å¯èƒ½åŒ…å«æœ‰ä¸åŒå€¼çš„ "),e("code",null,"Access-Control-Allow-Origin"),s("ï¼Œå³ä½¿è¯·æ±‚æ²¡æœ‰åŒ…å« "),e("code",null,"Access-Control-Allow-Origin"),s(" å¤´çš„å“åº”ï¼Œé‚£ä¹ˆ CDN åº”è¯¥æ€»æ˜¯åŒ…å«è¿”å› "),e("code",null,"Vary:Origin"),s(" å¤´éƒ¨ï¼Œä½ çš„åˆ†ææ˜¯æ­£ç¡®çš„ï¼šå¦‚æœå¤´ä¿¡æ¯ä¸æ€»æ˜¯å­˜åœ¨ï¼Œå°±æœ‰å¯èƒ½ç”¨ä¸æ­£ç¡®çš„å€¼å¡«å……ç¼“å­˜ã€‚")])],-1),N=e("code",null,"Vary",-1),V=e("blockquote",null,[e("p",null,[e("strong",null,[e("code",null,"Vary")]),s("Â æ˜¯ä¸€ä¸ª HTTP å“åº”å¤´éƒ¨ä¿¡æ¯ï¼Œå®ƒå†³å®šäº†å¯¹äºæœªæ¥çš„ä¸€ä¸ªè¯·æ±‚å¤´ï¼Œåº”è¯¥ç”¨ä¸€ä¸ªç¼“å­˜çš„å›å¤ (response) è¿˜æ˜¯å‘æºæœåŠ¡å™¨è¯·æ±‚ä¸€ä¸ªæ–°çš„å›å¤ã€‚")])],-1),F=e("p",null,"è¿™å¥è¯å¯èƒ½ä¸å¤ªèƒ½è¯´æ˜é—®é¢˜ï¼Œæˆ‘ä»¬ç»§ç»­çœ‹ MDN æä¾›çš„ä¸‹é¢çš„ä¾‹å­ï¼š",-1),I=e("code",null,"Vary",-1),H=e("code",null,"User-Agent",-1),z=e("p",null,[s("å³æ­¤æ—¶éœ€è¦è®¾ç½®ä¸º "),e("code",null,"Vary: User-Agent")],-1),x=e("p",null,[s("ä¹Ÿå°±æ˜¯è¯´å¦‚æœæˆ‘ä»¬éœ€è¦æ ¹æ® User-Agent çš„ä¸åŒæŒ‡æŒ¥æµè§ˆå™¨å»è¯»å†™ç¼“å­˜ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ä½¿ç”¨ "),e("code",null,"Vary: User-Agent"),s(" å¤´æ¥å®ç°ã€‚")],-1),L=e("p",null,[s("æ­¤åˆ»æˆ‘ä»¬å†å»çœ‹çœ‹é˜¿é‡Œäº‘ OSS çš„è·¨åŸŸè®¾ç½®é€‰é¡¹å½“ä¸­çš„æœ€åä¸€é¡¹ä¸‹é¢çš„æ³¨é‡Šï¼š"),e("strong",null,"è¿”å› Vary: Origin")],-1),M=e("p",null,[s("å…³é”®çš„ä¿¡æ¯æ˜¯ï¼š"),e("strong",null,"å¦‚æœæµè§ˆå™¨åŒæ—¶å­˜åœ¨ CORS å’Œé CORS è¯·æ±‚ï¼Œè¯·å¯ç”¨è¯¥é€‰é¡¹å¦åˆ™ä¼šå‡ºç°è·¨åŸŸé—®é¢˜ã€‚")],-1),U=e("code",null,"Origin: <è¯·æ±‚æ¥æºåŸŸå>",-1),j=e("code",null,"Vary: Origin",-1),G=l("",6);function X(W,Q,Y,$,J,K){const i=n("NolebasePageProperties"),a=n("VPNolebaseInlineLinkPreview"),r=n("NolebaseUnlazyImg"),h=n("NolebaseGitContributors"),c=n("NolebaseGitChangelog");return _(),p("div",null,[k,t(i),A,e("p",null,[s("è°ƒæŸ¥æµè§ˆå™¨çš„å¼€å‘è€…å·¥å…·çš„æ§åˆ¶å°çš„æ—¶å€™å‘ç°æ˜¯å›¾ç‰‡ç›¸å…³çš„å“åº”æœªæ­£ç¡®æŒ‰ç…§ CORS æœŸæœ›çš„è®¾å®šè¿”å› "),f,s(" å¤´éƒ¨ï¼Œè§¦å‘äº† CORS ç­–ç•¥é”™è¯¯å¯¼è‡´ã€‚ è€Œå¦‚æœä¸ä½¿ç”¨ CORS ç­–ç•¥ï¼ˆå³æ‰“å¼€ html2canvas é…ç½®é€‰é¡¹ä¸­çš„ "),C,s(" é€‰é¡¹ï¼‰è¯·æ±‚å›¾ç‰‡çš„è¯ï¼Œä¼šå¯¼è‡´ canvas å˜æˆä¸å®‰å…¨çš„ canvasï¼Œæˆ–è€…è¯´æ˜¯è¢«æ±¡æŸ“çš„ canvasï¼ˆå‚è§ï¼š"),t(a,{href:"https://developer.mozilla.org/zh-CN/docs/Web/HTML/CORS_enabled_image",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("å¯ç”¨äº† CORS çš„å›¾ç‰‡ - HTMLï¼ˆè¶…æ–‡æœ¬æ ‡è®°è¯­è¨€ï¼‰ | MDN")]),_:1}),s("ï¼‰ï¼Œåœ¨è¿™æ ·çš„æƒ…å†µä¸‹ï¼Œå°†ä¸å¯ä½¿ç”¨ canvas ä¸Šä¸‹æ–‡ context è°ƒç”¨ä¸‹åˆ—å‡½æ•°ï¼š")]),S,e("p",null,[s("åœ¨ç½‘ç»œä¸Šæœç´¢ç›¸å…³èµ„æ–™çš„æ—¶å€™å‘ç°å¤§å¤šæ•°äººéƒ½æåˆ°äº†ä¸€ä¸ªä¹‹å‰æˆ‘ä»¬å¼€å‘æ—¶å¿½ç•¥çš„ "),v,s(" å±æ€§ "),m,s("ï¼ˆå‚è€ƒèµ„æ–™ï¼š"),t(a,{href:"https://developer.mozilla.org/en-US/docs/Web/API/HTMLImageElement/crossOrigin#value",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("HTMLImageElement.crossOrigin - Web APIs | MDN")]),_:1}),s("ï¼‰ã€‚")]),O,e("ul",null,[e("li",null,[e("p",null,[t(a,{href:"https://stackoverflow.com/questions/29105249/html2canvas-with-cors-in-s3-and-cloudfront",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("javascript - HTML2Canvas with CORS in S3 and CloudFront - Stack Overflow")]),_:1})])]),e("li",null,[e("p",null,[t(a,{href:"https://stackoverflow.com/questions/46257444/how-to-avoid-cors-error-when-drawing-image-onto-canvas",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("javascript - How to avoid CORS error when drawing image onto canvas? - Stack Overflow")]),_:1})])])]),b,e("p",null,[s("å…ˆå‰çš„é—®é¢˜è¿˜æ˜¯æ²¡æœ‰è§£å†³ï¼Œäºæ˜¯æˆ‘å»ç»§ç»­å¯»æ‰¾å…¶ä»–é—®é¢˜çš„ç­”æ¡ˆã€‚æœ‰å¦ä¸€ä¸ªé—®é¢˜æ˜¯å°éŸ³è¯¢é—®æˆ‘çš„ï¼š"),y,s("ã€‚è¯´å®è¯æˆ‘ä¹Ÿä¸çŸ¥é“è¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆï¼Œäºæ˜¯åœ¨ç½‘ç»œä¸Šæœç´¢ã€‚ä¹Ÿå°±æ˜¯åœ¨è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘åœ¨ "),t(a,{href:"https://stackoverflow.com/questions/21638606/using-cors-headers-with-css-background-image",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("cross domain - Using CORS headers with CSS background-image - Stack Overflow")]),_:1}),s(" StackOverflow é—®ç­”ä¸Šè§åˆ°äº†ä¸€å¥è¯„è®ºï¼š")]),e("blockquote",null,[e("p",null,[s(`After doing some research I have determined that the real problem is that Amazon S3 doesn't set the "Vary: Origin" header even if it is configured to support CORS. If anyone knows how to get S3 to do that, that would also be a good answer. â€“Â `),t(a,{href:"https://stackoverflow.com/users/2543666/thayne",title:"6,381 reputation",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("Thayne")]),_:1}),s(),t(a,{href:"https://stackoverflow.com/questions/21638606/using-cors-headers-with-css-background-image#comment32821554_21638606",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("Feb 11, 2014 at 16:17")]),_:1})])]),B,w,P,e("blockquote",null,[e("p",null,[s("Yes. If a request may contain aÂ "),T,s("Â with different values, then the CDN should always respond withÂ "),q,s(", even for responses without anÂ "),R,s("Â header. Your analysis is correct: if the header isn't always present, it would be possible to fill the cache with incorrect values. â€“ "),t(a,{href:"https://stackoverflow.com/users/107250/monsur",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("monsur")]),_:1}),t(a,{href:"https://stackoverflow.com/a/25329887",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("answeredÂ Aug 15, 2014 at 16:02")]),_:1})])]),D,E,e("p",null,[s("æ­¤æ—¶æ­¤åˆ»æˆ‘ä»¬å»å¯»æ‰¾ MDN å…³äº "),N,s(" å¤´éƒ¨çš„æ–‡æ¡£ "),t(a,{href:"https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Vary",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("Vary - HTTP | MDN")]),_:1}),s("ï¼Œå°±èƒ½çœ‹åˆ°ï¼š")]),V,F,e("blockquote",null,[e("p",null,[s("å“ªç§æƒ…å†µä¸‹ä½¿ç”¨ "),I,s("ï¼Ÿå¯¹äº "),H,s("Â å¤´éƒ¨ä¿¡æ¯ï¼Œä¾‹å¦‚ä½ æä¾›ç»™ç§»åŠ¨ç«¯çš„å†…å®¹æ˜¯ä¸åŒçš„ï¼Œå¯ç”¨é˜²æ­¢ä½ å®¢æˆ·ç«¯è¯¯ä½¿ç”¨äº†ç”¨äºæ¡Œé¢ç«¯çš„ç¼“å­˜ã€‚ å¹¶å¯å¸®åŠ© Google å’Œå…¶ä»–æœç´¢å¼•æ“æ¥å‘ç°ä½ çš„ç§»åŠ¨ç«¯ç‰ˆæœ¬çš„é¡µé¢ï¼ŒåŒæ—¶å‘ŠçŸ¥ä»–ä»¬ä¸éœ€è¦ "),t(a,{href:"https://en.wikipedia.org/wiki/Cloaking",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("Cloaking")]),_:1}),s("ã€‚")]),z,e("p",null,[s("â€”â€” æ¥æº "),t(a,{href:"https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Vary#%E5%8A%A8%E6%80%81%E6%9C%8D%E5%8A%A1",title:"Permalink to åŠ¨æ€æœåŠ¡",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("åŠ¨æ€æœåŠ¡")]),_:1})])]),x,L,e("p",null,[t(r,{src:u,alt:"",thumbhash:"/fcFAYCplldYhPdU+w2131A=",placeholderSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAFCAYAAAAkG+5xAAACpElEQVR4AQCBAH7/AO3x8//v8/X/8/f5//f7/f/7/////f////3////8////+/////r+///7/////v//////////////////////////////////////////////////////////////////////////////////////////////////////////////AIEAfv8A7fHz/+/z9f/y9vj/9fn7//f7/f/3+/3/9fn7//L2+P/u8/X/6+/x/+ru8P/q7vD/7PHz//D09v/y9/n/9Pj6//T4+v/x9ff/7fHz/+jt7//l6ev/4+fp/+Pn6f/m6uz/6u7w/+3y9P/x9ff/8vb4//P3+f/y9vj/8fX3//D09v8AgQB+/wDy9vj/8/f5//X5+//3+/3/+Pz+//b6/P/y9vj/7fHz/+fr7f/i5uj/3+Pl/93h4//e4uT/3+Pl/+Hl5//h5ef/3+Pl/9zg4v/X297/09fZ/8/T1f/O0tT/z9PV/9LW2P/X293/3ODi/+Hl5//k6Or/5ers/+bq7P/l6ev/5enr/wCBAH7/APv////9//////////////////////////v////2+vz/8PT2/+vv8v/o7O7/5+vt/+js7v/p7vD/6+/x/+zw8v/q7vD/5+vt/+Lm6P/d4eP/2t7g/9jc3v/Z3d//3eHj/+Lm6P/o7O7/7fHz//H19//z9/n/9Pj6//T4+v/0+Pr/AYEAfv8A///////////////////////////////////////////+////+/////n9///5/f//+/////3////////////////////9////+Pz///T4+v/w9Pb/7vP1//D09v/z9/n/+Pz+//7///////////////////////////////////+3XmhW39ouuQAAAABJRU5ErkJggg==",width:"1212",height:"246",autoSizes:"true"})]),M,e("p",null,[s("ç»¼ä¸Šæ‰€è¿°ï¼Œå¯¹äºåœ¨è·¨åŸŸåœºæ™¯ä¸‹çš„ GET è¯·æ±‚è€Œè¨€ï¼Œæˆ‘ä»¬èƒ½çŸ¥é“ç”±äº CORS ç­–ç•¥æ‰€äº§ç”Ÿçš„çš„ OPTIONS é¢„æ£€è¯·æ±‚ç›¸æ¯”é CORS ç­–ç•¥é™åˆ¶çš„çš„ GET è¯·æ±‚å¤šäº† "),U,s(" å¤´éƒ¨ï¼Œé‚£ä¹ˆå…ˆå‰åœ¨ "),t(a,{href:"https://stackoverflow.com/questions/21638606/using-cors-headers-with-css-background-image",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("cross domain - Using CORS headers with CSS background-image - Stack Overflow")]),_:1}),s(" StackOverflow é—®ç­”ä¸­çœ‹åˆ°çš„è¯„è®ºæ‰€æåˆ°çš„ "),j,s(" å¤´éƒ¨çš„ä½œç”¨å°±å¯ä»¥ç†è§£ä¸ºï¼š")]),G,t(h),t(c)])}const se=d(g,[["render",X]]);export{ee as __pageData,se as default};
