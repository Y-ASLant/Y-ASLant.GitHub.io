import{_ as r,c as d,I as a,j as i,a as s,w as t,au as l,D as n,o}from"./chunks/framework.RMxno62p.js";const x=JSON.parse('{"title":"é…ç½® GitLab CI è‡ªåŠ¨éƒ¨ç½²","description":"","frontmatter":{"tags":["ç½‘ç«™/GitLab","å¼€å‘/CICD","å¼€å‘/CICD/GitLab-CI","å¼€å‘/æ ‡è®°è¯­è¨€/YAML","æ“ä½œç³»ç»Ÿ/CentOS","å‘½ä»¤è¡Œ/yum","å‘½ä»¤è¡Œ/chmod","å¼€å‘/DevOps","å‘½ä»¤è¡Œ/git","å¼€å‘/æ ‡è®°è¯­è¨€/TOML","å‘½ä»¤è¡Œ","è®¡ç®—æœº/æ“ä½œç³»ç»Ÿ/Linux","è®¡ç®—æœº/æ“ä½œç³»ç»Ÿ/Linux/å‘½ä»¤è¡Œ","æ“ä½œç³»ç»Ÿ/Linux","å¼€å‘/Git"]},"headers":[],"relativePath":"ç¬”è®°/ğŸ› ï¸ å¼€å‘/ğŸŸ¢ æŒç»­é›†æˆ æŒç»­äº¤ä»˜ CICD/GitLab/é…ç½® GitLab CI CD è‡ªåŠ¨éƒ¨ç½².md","filePath":"ç¬”è®°/ğŸ› ï¸ å¼€å‘/ğŸŸ¢ æŒç»­é›†æˆ æŒç»­äº¤ä»˜ CICD/GitLab/é…ç½® GitLab CI CD è‡ªåŠ¨éƒ¨ç½².md"}'),c={name:"ç¬”è®°/ğŸ› ï¸ å¼€å‘/ğŸŸ¢ æŒç»­é›†æˆ æŒç»­äº¤ä»˜ CICD/GitLab/é…ç½® GitLab CI CD è‡ªåŠ¨éƒ¨ç½².md"},g=i("h1",{id:"é…ç½®-gitlab-ci-è‡ªåŠ¨éƒ¨ç½²",tabindex:"-1"},[s("é…ç½® GitLab CI è‡ªåŠ¨éƒ¨ç½² "),i("a",{class:"header-anchor",href:"#é…ç½®-gitlab-ci-è‡ªåŠ¨éƒ¨ç½²","aria-label":'Permalink to "é…ç½® GitLab CI è‡ªåŠ¨éƒ¨ç½²"'},"â€‹")],-1),y=l('<p>æœ¬æ•™ç¨‹é¢„æœŸå®ç°å°†å‰ç«¯ä»£ç æäº¤åˆ° test åˆ†æ”¯æˆ–è€…åˆå¹¶åˆ° test åˆ†æ”¯æ—¶è§¦å‘è‡ªåŠ¨éƒ¨ç½²è„šæœ¬ï¼Œä»è€Œå®ç°è‡ªåŠ¨éƒ¨ç½²æµ‹è¯•ç¯å¢ƒçš„ç›®çš„ã€‚</p><blockquote><p>æœ¬ç¯‡ä¸åŒ…å«å¦‚ä½•å»ºç«‹ç½‘ç«™æœåŠ¡å™¨çš„å†…å®¹ï¼Œåªè®²è¿°å¦‚ä½•é…ç½® GitLab CIã€‚</p></blockquote><h2 id="å°†è¦ä½¿ç”¨åˆ°çš„å·¥å…·" tabindex="-1">å°†è¦ä½¿ç”¨åˆ°çš„å·¥å…· <a class="header-anchor" href="#å°†è¦ä½¿ç”¨åˆ°çš„å·¥å…·" aria-label="Permalink to &quot;å°†è¦ä½¿ç”¨åˆ°çš„å·¥å…·&quot;">â€‹</a></h2><h3 id="_1-gitlab-runner" tabindex="-1">1. gitlab-runner <a class="header-anchor" href="#_1-gitlab-runner" aria-label="Permalink to &quot;1. gitlab-runner&quot;">â€‹</a></h3><p>æ˜¯ä¸€ä¸ªä¸ GitLab CI/CD è”åŠ¨ï¼Œåœ¨æœåŠ¡ç«¯è¿è¡Œ CI/CD ä½œä¸šçš„è‡ªåŠ¨åŒ–ç¨‹åºã€‚</p><h3 id="_2-gitlab-ci-ymlæ–‡ä»¶" tabindex="-1">2. <code>.gitlab-ci.yml</code>æ–‡ä»¶ <a class="header-anchor" href="#_2-gitlab-ci-ymlæ–‡ä»¶" aria-label="Permalink to &quot;2. `.gitlab-ci.yml`æ–‡ä»¶&quot;">â€‹</a></h3>',6),u=l(`<h2 id="é…ç½®æµç¨‹" tabindex="-1">é…ç½®æµç¨‹ <a class="header-anchor" href="#é…ç½®æµç¨‹" aria-label="Permalink to &quot;é…ç½®æµç¨‹&quot;">â€‹</a></h2><h3 id="å®‰è£…-gitlab-runner" tabindex="-1">å®‰è£… GitLab Runner <a class="header-anchor" href="#å®‰è£…-gitlab-runner" aria-label="Permalink to &quot;å®‰è£… GitLab Runner&quot;">â€‹</a></h3><ol><li>ç§»é™¤æ—§ç‰ˆæœ¬ä»“åº“</li></ol><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> rm</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /etc/yum.repos.d/runner_gitlab-ci-multi-runner.repo</span></span></code></pre></div><ol start="2"><li>æ·»åŠ  GitLab&#39;s å®˜æ–¹ä»“åº“</li></ol><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -L</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> https://packages.gitlab.com/install/repositories/runner/gitlab-runner/script.rpm.sh</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> bash</span></span></code></pre></div><ol start="3"><li>ä¸‹è½½æœ€æ–°ç‰ˆ GitLab Runner</li></ol><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> yum</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> gitlab-runner</span></span></code></pre></div><h4 id="æ³¨å†Œ-gitlab-runner" tabindex="-1">æ³¨å†Œ GitLab Runner <a class="header-anchor" href="#æ³¨å†Œ-gitlab-runner" aria-label="Permalink to &quot;æ³¨å†Œ GitLab Runner&quot;">â€‹</a></h4><p>å®‰è£…å¥½äº†gitlab-runnerï¼Œè¿˜è¦è¿›è¡Œæ³¨å†Œï¼Œæ‰§è¡Œä»¥ä¸‹æ“ä½œ</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> gitlab-runner</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> register</span></span></code></pre></div><h4 id="ä¹‹åä¼šä¸ºæ³¨å†Œè¾“å…¥ä¸€ç³»åˆ—ä¿¡æ¯" tabindex="-1">ä¹‹åä¼šä¸ºæ³¨å†Œè¾“å…¥ä¸€ç³»åˆ—ä¿¡æ¯ <a class="header-anchor" href="#ä¹‹åä¼šä¸ºæ³¨å†Œè¾“å…¥ä¸€ç³»åˆ—ä¿¡æ¯" aria-label="Permalink to &quot;ä¹‹åä¼šä¸ºæ³¨å†Œè¾“å…¥ä¸€ç³»åˆ—ä¿¡æ¯&quot;">â€‹</a></h4><ol><li>å¡«å†™ä»“åº“æ‰€åœ¨ GitLab æœåŠ¡å™¨çš„ URL</li></ol><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Enter</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> your</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> GitLab</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> instance</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> URL:</span></span></code></pre></div><p>ä¾‹å¦‚ï¼š<code>http://gitlab.example.com/</code></p><ol start="2"><li>å¡«å†™å¯¹åº” GitLab ä»“åº“çš„ Runner token ä¿¡æ¯</li></ol><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Enter</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> the</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> token</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> you</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> obtained</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> register</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> the</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Runner</span></span></code></pre></div><p>è¿›å…¥ GitLab ä»“åº“çš„<code>è®¾ç½®</code> -&gt; <code>CI/CD</code> -&gt; <code>Runner</code> å°±å¯ä»¥çœ‹åˆ° Runner çš„ Token äº†ï¼ŒæŠŠå®ƒå¤åˆ¶è¿‡æ¥ï¼Œè´´ä¸Šã€‚</p><ol start="3"><li>Runner çš„æè¿°</li></ol><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Enter</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> a</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> description</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> for</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> the</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Runner,</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> you</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> can</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> change</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> this</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> later</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> in</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> GitLab&#39;s UI:</span></span></code></pre></div><p>ç®€çŸ­çš„æè¿°ä¸€ä¸‹è¿™ä¸ª Runner</p><ol start="4"><li>Runner çš„æ ‡ç­¾</li></ol><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> Enter theÂ tags associated with the Runner, you can change this later in GitLab</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;s UI:</span></span></code></pre></div><p>GitLab CI ä¼šé€šè¿‡æ ‡ç­¾æ¥åˆ¤æ–­éœ€è¦å§ gitlab-ci.yml è„šæœ¬ä¸­çš„ä»»åŠ¡åˆ†é…ç»™å“ªä¸ª Runnerã€‚ è¿™é‡Œå¯ä»¥å¡«å†™ <code>test, deploy</code>ï¼Œç”¨é€—å·åˆ†éš”ä¸åŒçš„æ ‡ç­¾ã€‚</p><h4 id="å¯åŠ¨-runner-æœåŠ¡" tabindex="-1">å¯åŠ¨ Runner æœåŠ¡ <a class="header-anchor" href="#å¯åŠ¨-runner-æœåŠ¡" aria-label="Permalink to &quot;å¯åŠ¨ Runner æœåŠ¡&quot;">â€‹</a></h4><p>æ³¨å†Œå¥½ä¹‹åå¦‚æœåœ¨ <code>è®¾ç½®</code> -&gt; <code>CI/CD</code> -&gt; <code>Runner</code> çš„ç•Œé¢ä¸Šçœ‹åˆ° Runner çš„æ—è¾¹ä¸æ˜¯ç»¿ç‚¹ï¼Œè€Œæ˜¯é»‘è‰²ä¸‰è§’çš„æ„Ÿå¹å·ï¼Œå¯ä»¥ä½¿ç”¨ <code>gitlab-runner start</code>æŒ‡ä»¤æ¥å¼€å¯ Runner çš„ Service åŒæ—¶æ”¯æŒ <code>restart</code> é‡å¯ã€<code>stop</code> åœæ­¢ã€<code>run</code> ç›´æ¥è¿è¡Œ ç­‰ç­‰çš„å‘½ä»¤ã€‚<code>run</code> å¯ä»¥é€šè¿‡åœ¨å‰é¢é™„åŠ  <code>--debug</code> å‘½ä»¤ï¼Œå¼€å¯è¯¦ç»†çš„æ—¥å¿—è¾“å‡ºã€‚</p><h3 id="ç¼–å†™-shell-è„šæœ¬" tabindex="-1">ç¼–å†™ shell è„šæœ¬ <a class="header-anchor" href="#ç¼–å†™-shell-è„šæœ¬" aria-label="Permalink to &quot;ç¼–å†™ shell è„šæœ¬&quot;">â€‹</a></h3><p>æ¥ä¸‹æ¥æˆ‘ä»¬å†™è„šæœ¬æ–‡ä»¶ï¼Œå› ä¸ºæˆ‘ä»¬é‡‡ç”¨çš„æ˜¯linuxç³»ç»Ÿï¼Œæ‰€ä»¥ç”¨çš„æ˜¯shellæ–‡ä»¶ <strong>shell è„šæœ¬è¦åšçš„äº‹æƒ…å¯ä»¥åˆ†ä¸ºè¿™äº›æ­¥éª¤:</strong></p><ol><li>ä» GitLab ä¸Š git clone/fetch é¡¹ç›®èµ„æºã€‚ è¿™ä¸€æ­¥å…¶å® gitlab-runner ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬å®Œæˆï¼Œæ‰€ä»¥å¯ä»¥çœç•¥ã€‚</li><li>è¿›å…¥é¡¹ç›®ä¸­ å› ä¸ºæˆ‘ä»¬çš„è„šæœ¬æ˜¯æ”¾åœ¨é¡¹ç›®ä¸­çš„ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼è·å–åˆ° shell è„šæœ¬çš„ä½ç½®ï¼Œè¿›è€Œå®šä½åˆ°é¡¹ç›®è·¯å¾„ã€‚</li></ol><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">BASEDIR</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">dirname</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">$0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">cd</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> $BASEDIR</span></span></code></pre></div><ol start="3"><li>æ‰§è¡Œ npm installï¼ˆæˆ–è€… yarn/pnpmï¼‰</li><li>æ‰§è¡Œ build æ‰“åŒ…</li></ol><h4 id="æœ€åå®Œæ•´-shell-è„šæœ¬å¦‚ä¸‹" tabindex="-1">æœ€åå®Œæ•´ shell è„šæœ¬å¦‚ä¸‹ <a class="header-anchor" href="#æœ€åå®Œæ•´-shell-è„šæœ¬å¦‚ä¸‹" aria-label="Permalink to &quot;æœ€åå®Œæ•´ shell è„šæœ¬å¦‚ä¸‹&quot;">â€‹</a></h4><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># ci/deploy_staging.sh</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># æµ‹è¯•ç½‘çš„éƒ¨ç½²è„šæœ¬</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># é‡åˆ°é”™è¯¯æ—¶é€€å‡ºï¼Œæ›´åŠ å¯è¯»çš„ç‰ˆæœ¬æ˜¯ï¼šset -o errexit</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">set</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -e</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;============================&quot;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;=== Start deploy staging ===&quot;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;============================&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># è®¿é—®è„šæœ¬æ‰€åœ¨çš„çš„é¡¹ç›®æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">BASEDIR</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">dirname</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">$0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">cd</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> $BASEDIR</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ..</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;==== Copy product files ====&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># æ‹·è´æ–‡ä»¶åˆ°éƒ¨ç½²æ–‡ä»¶å¤¹</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># å¼€å¯ åœ°å€é€šé…ç¬¦åŠŸèƒ½</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">shopt</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> extglob</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># åˆ é™¤éƒ¨ç½²æ–‡ä»¶å¤¹ä¸­ä¹‹å‰ç•™ä¸‹çš„æ–‡ä»¶ï¼Œåªä¿ç•™ distï¼ˆæ„å»ºäº§ç‰©ï¼‰ å’Œ node_modules ï¼ˆä¾èµ–ï¼‰æ–‡ä»¶å¤¹</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> rm</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -rf</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /usr/share/frontend/!</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">dist</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node_modules</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># åˆ é™¤ . å¼€å¤´çš„éšè—æ–‡ä»¶ï¼Œå®ƒä»¬æ˜¯æ¼ç½‘ä¹‹é±¼</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> rm</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -rf</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /usr/share/frontend/{.[!.],..?}</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">*</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;Remaining filesï¼š&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">ls</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -la</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /usr/share/frontend/</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># ä¸ºäº†é˜²æ­¢å› ä¸ºæ²¡æœ‰æƒé™å¤åˆ¶è€Œå‡ºé”™ï¼Œé¢„å…ˆè®¾ç½®ç½²æ–‡ä»¶å¤¹çš„æƒé™ç»„ä¸º gitlab-runner</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> chown</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -R</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> gitlab-runner:gitlab-runner</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /usr/share/frontend</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># æ‹·è´è‡³éƒ¨ç½²æ–‡ä»¶å¤¹</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">cp</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -r</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> .</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /usr/share/frontend/</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># è®¾ç½®ä¸€æ¬¡éƒ¨ç½²æ–‡ä»¶å¤¹å†…æ–°æ”¾è¿›å»æ–‡ä»¶çš„æƒé™ï¼Œå…è®¸è¯»å†™å’Œæ‰§è¡Œ</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> chmod</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -R</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 775</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /usr/share/frontend</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># è¿›å…¥éƒ¨ç½²æ–‡ä»¶å¤¹</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /usr/share/frontend/</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;==== Start pnpm install ====&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># å®‰è£…ä¾èµ–</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> install</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;===== Start build test =====&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># ç¼–è¯‘é¡¹ç›®</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> test</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;=============================&quot;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;== Finished deploy staging ==&quot;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;=============================&quot;</span></span></code></pre></div><blockquote><p>æˆ‘å°†å…¶æ”¾åœ¨äº†é¡¹ç›®çš„ <code>ci/deploy_staging.sh</code> ç›®å½•é‡Œ</p></blockquote><p>å¯ä»¥çœ‹åˆ°å®Œæ•´çš„ä»£ç ä¸­å¢åŠ äº†<strong>æ‹·è´è‡³éƒ¨ç½²æ–‡ä»¶å¤¹</strong>çš„æ­¥éª¤ã€‚è¿™æ˜¯å› ä¸ºï¼Œå¦‚æœç›´æ¥åœ¨ Runner çš„é¡¹ç›®æ–‡ä»¶å¤¹ä¸­æ“ä½œçš„è¯ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ–°åˆ›å»ºçš„æ–‡ä»¶<strong>æ— æ³•åœ¨ä¸‹æ¬¡ CI ä½œä¸š git clone å‰è¢«ç§»é™¤</strong>ï¼Œè€Œæ— æ³•ä» git åŒæ­¥ä»£ç å°†ä¼šå¯¼è‡´<strong>æ•´ä¸ª Runner è¢«é˜»å¡</strong>ã€‚åŸå› å¯èƒ½æ˜¯å› ä¸ºæŸäº›æ–‡ä»¶çš„æƒé™ç»„ä¸º root ï¼Œä¹Ÿå¯èƒ½æ˜¯å› ä¸ºç‰ˆæœ¬æ§åˆ¶å¿½ç•¥äº†é‚£äº›æ–‡ä»¶ï¼Œç›®å‰è¿™ä¸ªé—®é¢˜çš„å…·ä½“æˆå› ä¸æ˜ã€‚ä¸ºäº†é¿å…è¿™ä¸ªé—®é¢˜ï¼Œ<strong>æ‰€ä»¥æˆ‘ä»¬åœ¨ä¸€ä¸ªæ–°æ–‡ä»¶å¤¹ä¸­æ‰§è¡Œ npm install å’Œ npm build æ“ä½œ</strong>æ¥é¿å…è¿™ç§æƒ…å†µã€‚</p><h3 id="è®¾ç½®-gitlab-runner-ç”¨æˆ·æƒé™" tabindex="-1">è®¾ç½® gitlab-runner ç”¨æˆ·æƒé™ <a class="header-anchor" href="#è®¾ç½®-gitlab-runner-ç”¨æˆ·æƒé™" aria-label="Permalink to &quot;è®¾ç½® gitlab-runner ç”¨æˆ·æƒé™&quot;">â€‹</a></h3><p>ä¸ºäº†ç¡®ä¿ Runner æ­£å¸¸è¿è¡Œè¿™ä¸ª shell è„šæœ¬ï¼Œéœ€è¦ç»™ <code>gitlab-runner</code> ç”¨æˆ·æ·»åŠ æ‰§è¡Œ <code>sudo</code> å‘½ä»¤çš„æƒé™ã€‚</p><h4 id="_1-å°†-gitlab-runner-ç”¨æˆ·åŠ å…¥-wheel-ç”¨æˆ·ç»„" tabindex="-1">1. å°† gitlab-runner ç”¨æˆ·åŠ å…¥ wheel ç”¨æˆ·ç»„ <a class="header-anchor" href="#_1-å°†-gitlab-runner-ç”¨æˆ·åŠ å…¥-wheel-ç”¨æˆ·ç»„" aria-label="Permalink to &quot;1. å°† gitlab-runner ç”¨æˆ·åŠ å…¥ wheel ç”¨æˆ·ç»„&quot;">â€‹</a></h4><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> usermod</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -g</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> wheel</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> gitlab-runner</span></span></code></pre></div><h4 id="_2-è®¾ç½®-whell-ç»„çš„-sudo-å‘½ä»¤æƒé™-å…è®¸å…å¯†ç æ‰§è¡Œ-sudo" tabindex="-1">2. è®¾ç½® whell ç»„çš„ sudo å‘½ä»¤æƒé™ï¼Œå…è®¸å…å¯†ç æ‰§è¡Œ sudo <a class="header-anchor" href="#_2-è®¾ç½®-whell-ç»„çš„-sudo-å‘½ä»¤æƒé™-å…è®¸å…å¯†ç æ‰§è¡Œ-sudo" aria-label="Permalink to &quot;2. è®¾ç½® whell ç»„çš„ sudo å‘½ä»¤æƒé™ï¼Œå…è®¸å…å¯†ç æ‰§è¡Œ sudo&quot;">â€‹</a></h4><ol><li><h5 id="åˆ‡æ¢åˆ°-root-ç”¨æˆ·ä¸‹" tabindex="-1">åˆ‡æ¢åˆ° <code>root</code> ç”¨æˆ·ä¸‹ <a class="header-anchor" href="#åˆ‡æ¢åˆ°-root-ç”¨æˆ·ä¸‹" aria-label="Permalink to &quot;åˆ‡æ¢åˆ° \`root\` ç”¨æˆ·ä¸‹&quot;">â€‹</a></h5></li></ol><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">su</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span></span></code></pre></div><ol start="3"><li><h5 id="æ‰“å¼€-sudoers-æ–‡ä»¶" tabindex="-1">æ‰“å¼€ <code>sudoers</code> æ–‡ä»¶ <a class="header-anchor" href="#æ‰“å¼€-sudoers-æ–‡ä»¶" aria-label="Permalink to &quot;æ‰“å¼€ \`sudoers\` æ–‡ä»¶&quot;">â€‹</a></h5></li></ol><p><code>sudoers</code> æ–‡ä»¶çš„ç›®å½•æ˜¯ <code>/etc/sudoers</code></p><p>æœ‰å¯èƒ½å‡ºç°æ— æ³•ç¼–è¾‘ <code>sudoers</code> æ–‡ä»¶çš„æƒ…å†µï¼Œéœ€è¦æ·»åŠ å†™æƒé™ï¼š</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">chmod</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> u+w</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /etc/sudoers</span></span></code></pre></div><p>é€šè¿‡ <code>vim</code> æˆ–è€… <code>nano</code> å‘½ä»¤ç¼–è¾‘</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">vim</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /etc/sudoers</span></span></code></pre></div><h5 id="_3-ç¼–è¾‘æ–‡ä»¶-è®¾ç½®-sudo-æƒé™" tabindex="-1">3. ç¼–è¾‘æ–‡ä»¶ï¼Œè®¾ç½® sudo æƒé™ <a class="header-anchor" href="#_3-ç¼–è¾‘æ–‡ä»¶-è®¾ç½®-sudo-æƒé™" aria-label="Permalink to &quot;3. ç¼–è¾‘æ–‡ä»¶ï¼Œè®¾ç½® sudo æƒé™&quot;">â€‹</a></h5><p>åœ¨ <code>sudoers</code> æ–‡ä»¶ä¸­æ‰¾åˆ° <code># %wheel ALL=(ALL) NOPASSWD: ALL</code> è¿™ä¸€è¡Œï¼Œå°†å®ƒå‰é¢çš„æ³¨é‡Šï¼Œä¹Ÿå°±æ˜¯ <code>#</code> å»æ‰ï¼Œç„¶åä¿å­˜æ–‡ä»¶ã€‚å¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œä¹Ÿå¯ä»¥ç›´æ¥æ–°å»ºä¸€è¡Œå¡«å…¥è¿™æ®µæ–‡æœ¬ã€‚ç„¶åä¿å­˜æ–‡ä»¶å¹¶é€€å‡º</p><h5 id="_4-æ’¤é”€åˆšåˆšæ·»åŠ çš„-sudoers-æ–‡ä»¶å†™æƒé™" tabindex="-1">4. æ’¤é”€åˆšåˆšæ·»åŠ çš„ sudoers æ–‡ä»¶å†™æƒé™ <a class="header-anchor" href="#_4-æ’¤é”€åˆšåˆšæ·»åŠ çš„-sudoers-æ–‡ä»¶å†™æƒé™" aria-label="Permalink to &quot;4. æ’¤é”€åˆšåˆšæ·»åŠ çš„ sudoers æ–‡ä»¶å†™æƒé™&quot;">â€‹</a></h5><p>è¾“å…¥å¦‚ä¸‹å‘½ä»¤</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">chmod</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> u-w</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /etc/sudoers</span></span></code></pre></div><h3 id="ç¼–å†™-gitlab-ci-yml-è„šæœ¬" tabindex="-1">ç¼–å†™ .gitlab-ci.yml è„šæœ¬ <a class="header-anchor" href="#ç¼–å†™-gitlab-ci-yml-è„šæœ¬" aria-label="Permalink to &quot;ç¼–å†™ .gitlab-ci.yml è„šæœ¬&quot;">â€‹</a></h3>`,54),C=i("code",null,"CI/CD",-1),b=i("code",null,"æµæ°´çº¿",-1),F=i("code",null,"CI lint",-1),m=l(`<h4 id="å®Œæ•´çš„-gitlab-ci-yml-è„šæœ¬å¦‚ä¸‹" tabindex="-1">å®Œæ•´çš„ .gitlab-ci.yml è„šæœ¬å¦‚ä¸‹ <a class="header-anchor" href="#å®Œæ•´çš„-gitlab-ci-yml-è„šæœ¬å¦‚ä¸‹" aria-label="Permalink to &quot;å®Œæ•´çš„ .gitlab-ci.yml è„šæœ¬å¦‚ä¸‹&quot;">â€‹</a></h4><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">stages</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  - </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">deploy</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">.deploy_staging_default</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">&amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;">deploy_staging_default</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">  stage</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">deploy</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  # é€šè¿‡ shell æ‰§è¡Œçš„</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">  script</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">pwd</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    # é¿å…å…‹éš†ä¸‹æ¥çš„ .sh æ–‡ä»¶æ²¡æœ‰æ‰§è¡Œæƒé™å¯¼è‡´æ‰§è¡Œå¤±è´¥ï¼Œé¢„å…ˆæ·»åŠ æ‰§è¡Œæƒé™</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">sudo chmod -R a+x .</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    # æ‰§è¡Œéƒ¨ç½²è„šæœ¬</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">sudo ./ci/deploy_staging.sh</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  # tags æ ‡ç­¾è¡¨ç¤ºè¿™ä¸ª CI ä»»åŠ¡åœ¨ä¼šè¢«åˆ†é…ç»™å“ªäº› Runnerï¼Œåªæœ‰åŒ…å«å¦‚ä¸‹ tags ä¸­ä»»æ„ä¸€ä¸ªæˆ–å¤šä¸ªçš„ Runner æ‰ä¼šæ‰§è¡Œè¿™ä¸ªä»»åŠ¡ã€‚</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">  tags</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">test</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">deploy</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># åˆå¹¶åˆ° test åˆ†æ”¯æ—¶æ‰§çš„è„šæœ¬ï¼Œé€šè¿‡ only å­—æ®µçº¦æŸä¸º merge_requests æƒ…å†µä¸‹ ç›®æ ‡åˆ†æ”¯åç§°ä¸º â€œtestâ€ æ—¶æ‰ä¼šæ‰§è¡Œã€‚</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">deploy_staging1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  &lt;&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">deploy_staging_default</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">  only</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">    refs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">merge_requests</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">    variables</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">$CI_MERGE_REQUEST_TARGET_BRANCH_NAME == &quot;test&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># åœ¨ test åˆ†æ”¯ä¸Šç›´æ¥æ“ä½œæ—¶æ‰§è¡Œçš„è„šæœ¬ã€‚</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">deploy_staging2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  &lt;&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">deploy_staging_default</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">  only</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">test</span></span></code></pre></div><blockquote><p><code>.deploy_staging_default: &amp;deploy_staging_default</code></p><p><code>&lt;&lt;: *deploy_staging_default</code></p></blockquote><p>YAML æœ‰ä¸€ä¸ªåä¸ºâ€œé”šâ€çš„åŠŸèƒ½ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å®ƒåœ¨æ•´ä¸ªæ–‡æ¡£ä¸­å¤åˆ¶å†…å®¹ï¼Œè¿™é‡Œå°±ç”¨åˆ°äº†è¿™ä¸ªç‰¹æ€§æ¥å°†ä¸¤ç§ CI ç­–ç•¥ä¸­ç›¸åŒçš„éƒ¨åˆ†å†™åœ¨ä¸€èµ·ã€‚</p><h3 id="å®Œæˆè®¾ç½®" tabindex="-1">å®Œæˆè®¾ç½® <a class="header-anchor" href="#å®Œæˆè®¾ç½®" aria-label="Permalink to &quot;å®Œæˆè®¾ç½®&quot;">â€‹</a></h3><p>å®Œæˆå¦‚ä¸Šæ­¥éª¤åï¼Œå°†ç¼–è¾‘å¥½çš„ yaml å’Œ shell è„šæœ¬ä¿å­˜ã€æ¨é€åˆ° test åˆ†æ”¯ã€‚</p><p>å¦‚æœæ‰§è¡Œé¡ºåˆ©çš„è¯ï¼Œå°±å¯ä»¥çœ‹åˆ° <code>CI/CD</code> -&gt; <code>æµæ°´çº¿</code> ç•Œé¢å·²ç»å‘ç”Ÿäº†å˜åŒ–ï¼Œå¹¶ä¸”å®Œæˆäº†ä½ è®¾å®šçš„è‡ªåŠ¨éƒ¨ç½²ä»»åŠ¡ã€‚</p><p><strong>ä¸‹ä¸€æ­¥ï¼š</strong> <em>å¦‚æœä½ å°†å¸Œæœ›ç¼–è¯‘çš„äº§ç‰©ï¼Œä¾‹å¦‚ web æœåŠ¡å™¨ã€‚èƒ½å¤Ÿè¿è¡Œèµ·æ¥ï¼Œå¹¶æš´éœ²ç»™å¤–éƒ¨è®¿é—®ï¼Œè¯·å‚è€ƒå¦‚ä½•éƒ¨ç½²ç›¸å…³çš„æ•™ç¨‹æˆ–æ–‡æ¡£ã€‚</em></p><h4 id="æ•…éšœæ’é™¤" tabindex="-1">æ•…éšœæ’é™¤ <a class="header-anchor" href="#æ•…éšœæ’é™¤" aria-label="Permalink to &quot;æ•…éšœæ’é™¤&quot;">â€‹</a></h4><h5 id="permission-denied" tabindex="-1">permission denied <a class="header-anchor" href="#permission-denied" aria-label="Permalink to &quot;permission denied&quot;">â€‹</a></h5><p>å¦‚æœå‡ºç°æ‰§è¡Œå¤±è´¥çš„æƒ…å†µï¼Œæ£€æŸ¥ log å¦‚æœå­˜åœ¨ <code>permission denied</code> å­—æ ·ï¼Œè¯´æ˜ Runner è®¿é—®æ–‡ä»¶æ—¶å­˜åœ¨æƒé™é—®é¢˜ã€‚é€šè¿‡ <code>ls -la</code> æŸ¥çœ‹ <code>/home/gitlab-runner</code> æ–‡ä»¶å¤¹ã€ä»¥åŠé¡¹<strong>ç›®éƒ¨ç½²æ–‡ä»¶å¤¹</strong>æ˜¯å¦æ­£å¸¸èµ‹äºˆäº† gitlab-runner ç”¨æˆ·è¯»å†™å’Œæ‰§è¡Œæƒé™ã€‚</p><p>å‘ç°æƒé™è®¾ç½®æœ‰è¯¯ï¼Œå¯ä»¥é€šè¿‡ <code>chmod</code> å˜æ›´æƒé™ï¼Œ<code>chown</code> å˜æ›´æ‰€å±æƒä¹‹ç±»çš„æ–¹å¼è¿›è¡Œæƒé™çš„ä¿®æ”¹ã€‚</p><h5 id="æŸ¥çœ‹-gitlab-runner-æœåŠ¡è¿è¡Œæ—¶çš„-log" tabindex="-1">æŸ¥çœ‹ gitlab-runner æœåŠ¡è¿è¡Œæ—¶çš„ log <a class="header-anchor" href="#æŸ¥çœ‹-gitlab-runner-æœåŠ¡è¿è¡Œæ—¶çš„-log" aria-label="Permalink to &quot;æŸ¥çœ‹ gitlab-runner æœåŠ¡è¿è¡Œæ—¶çš„ log&quot;">â€‹</a></h5><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> status</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> gitlab-runner</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -l</span></span></code></pre></div><p>ä½¿ç”¨ <code>status</code> è·å–çŠ¶æ€ï¼Œ <code>-l</code> å‚æ•°è¡¨ç¤ºæ˜¾ç¤ºå®Œæ•´ logï¼Œè¿™ä¸ªåŠæ³•å¯ä»¥çœ‹åˆ°æœ€è¿‘çš„åæ¡ log</p><h5 id="é…ç½®æ–‡ä»¶" tabindex="-1">é…ç½®æ–‡ä»¶ <a class="header-anchor" href="#é…ç½®æ–‡ä»¶" aria-label="Permalink to &quot;é…ç½®æ–‡ä»¶&quot;">â€‹</a></h5><p>æœ‰æ—¶ä¹Ÿå¯ä»¥æ£€æŸ¥ Runner çš„é…ç½®æ–‡ä»¶ï¼Œç¡®å®šæ˜¯å¦å­˜åœ¨é…ç½®é”™çš„éƒ½çš„æƒ…å†µã€‚</p><p>Runner çš„é…ç½®æ–‡ä»¶ï¼š</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">cat</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /etc/gitlab-runner/config.toml</span></span></code></pre></div><p>gitlab-runner çš„ç³»ç»ŸæœåŠ¡è„šæœ¬:</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">cat</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /etc/systemd/system/gitlab-runner.service</span></span></code></pre></div>`,21);function A(E,_,B,v,f,q){const h=n("NolebasePageProperties"),e=n("VPNolebaseInlineLinkPreview"),p=n("NolebaseGitContributors"),k=n("NolebaseGitChangelog");return o(),d("div",null,[g,a(h),y,i("p",null,[s("ä¸€ä¸ªæ”¾åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ yaml æ–‡ä»¶ï¼Œé‡Œé¢æè¿°äº† CI/CD çš„è§¦å‘æ¡ä»¶å’Œå·¥ä½œæµç¨‹ã€‚ å…·ä½“è¯­æ³•å¯ä»¥å‚è€ƒ "),a(e,{href:"https://docs.gitlab.com/ee/ci/yaml/index.html",target:"_blank",rel:"noreferrer"},{default:t(()=>[s("å®˜æ–¹æ–‡æ¡£")]),_:1})]),u,i("p",null,[s("æ¥ä¸‹æ¥æˆ‘ä»¬å‚è€ƒ "),a(e,{href:"https://docs.gitlab.com/ee/ci/yaml/README.html",target:"_blank",rel:"noreferrer"},{default:t(()=>[s("å®˜æ–¹æ–‡æ¡£")]),_:1}),s(" çš„æ ¼å¼ï¼Œåœ¨Â .gitlab-ci.yml æ–‡ä»¶å†™å…¥è¦æ‰§è¡Œçš„æ­¥éª¤å’Œè§¦å‘æ¡ä»¶ã€‚ ç¼–å†™å®Œæˆåå¯ä»¥è¿›å…¥ GitLab é¡¹ç›®ï¼Œç„¶åé€‰æ‹© "),C,s(" -> "),b,s(" -> "),F,s("ï¼Œæ‰“å¼€**â€œéªŒè¯æ‚¨çš„GitLab CIé…ç½®â€** é¡µé¢ï¼Œåœ¨è¿™é‡Œå¯ä»¥æ ¡éªŒä½ çš„ .gitlab-ci.yml æ–‡ä»¶è¯­æ³•æ˜¯å¦æ­£ã€‚")]),m,a(p),a(k)])}const L=r(c,[["render",A]]);export{x as __pageData,L as default};
