import{_ as k,c as o,I as a,j as s,w as l,a as i,au as r,D as e,o as d}from"./chunks/framework.RMxno62p.js";const E=JSON.parse('{"title":"完全卸载集群内的 kube-proxy","description":"","frontmatter":{"tags":["运维/云原生/Kubernetes","运维/云原生/Kubernetes/K8s","开发/云原生/Kubernetes","开发/云原生/Kubernetes/K8s","软件/云原生/kubelet","命令行/kubectl","软件/云原生/kubectl","命令行/ip","命令行/ipvsadm","软件/云原生/ipvsadm","计算机/网络/Calico","运维/Calico","软件/云原生/Calico","运维/Cilium","计算机/网络/Cilium","命令行/cilium","软件/云原生/Cilium"]},"headers":[],"relativePath":"笔记/🧱 基础设施/🚢 Kubernetes/完全卸载集群内的 `kube-proxy`.md","filePath":"笔记/🧱 基础设施/🚢 Kubernetes/完全卸载集群内的 `kube-proxy`.md"}'),c={name:"笔记/🧱 基础设施/🚢 Kubernetes/完全卸载集群内的 `kube-proxy`.md"},u=s("h1",{id:"完全卸载集群内的-kube-proxy",tabindex:"-1"},[i("完全卸载集群内的 "),s("code",null,"kube-proxy"),i(),s("a",{class:"header-anchor",href:"#完全卸载集群内的-kube-proxy","aria-label":'Permalink to "完全卸载集群内的 `kube-proxy`"'},"​")],-1),g=s("h3",{id:"文档兼容性",tabindex:"-1"},[i("文档兼容性 "),s("a",{class:"header-anchor",href:"#文档兼容性","aria-label":'Permalink to "文档兼容性"'},"​")],-1),y={tabindex:"0"},b=s("thead",null,[s("tr",null,[s("th",null,"主体"),s("th",null,"版本号"),s("th",null,"文档地址（如果有）")])],-1),C=s("td",null,"kubeadm",-1),F=s("td",null,"1.28",-1),m=s("code",null,"kube-proxy",-1),_=r('<h2 id="备份-kube-proxy-相关的配置" tabindex="-1">备份 <code>kube-proxy</code> 相关的配置 <a class="header-anchor" href="#备份-kube-proxy-相关的配置" aria-label="Permalink to &quot;备份 `kube-proxy` 相关的配置&quot;">​</a></h2><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ds</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> kube-system</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> kube-proxy</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> yaml</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> kube-proxy-daemonset.yaml</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> cm</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> kube-system</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> kube-proxy</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> yaml</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> kube-proxy-configmap.yaml</span></span></code></pre></div><h2 id="删除相关的-daemonset" tabindex="-1">删除相关的 <code>DaemonSet</code> <a class="header-anchor" href="#删除相关的-daemonset" aria-label="Permalink to &quot;删除相关的 `DaemonSet`&quot;">​</a></h2><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> kubectl</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> kube-system</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> delete</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ds</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> kube-proxy</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">daemonset.apps</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;kube-proxy&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> deleted</span></span></code></pre></div><h2 id="删除相关的-configmap" tabindex="-1">删除相关的 <code>ConfigMap</code> <a class="header-anchor" href="#删除相关的-configmap" aria-label="Permalink to &quot;删除相关的 `ConfigMap`&quot;">​</a></h2><p>目的是为了<strong>防止以后使用 <code>kubeadm</code> 升级 K8s 的时候重新安装了 <code>kube-proxy</code>（1.19 版本之后的 K8S ）</strong>。</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> kubectl</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> kube-system</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> delete</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> cm</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> kube-proxy</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">configmap</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;kube-proxy&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> deleted</span></span></code></pre></div><h2 id="清除掉-iptables-规则和-ipvs-规则以及-ipvs0-网卡" tabindex="-1">清除掉 <code>iptables</code> 规则和 <code>ipvs</code> 规则以及 <code>ipvs0</code> 网卡 <a class="header-anchor" href="#清除掉-iptables-规则和-ipvs-规则以及-ipvs0-网卡" aria-label="Permalink to &quot;清除掉 `iptables` 规则和 `ipvs` 规则以及 `ipvs0` 网卡&quot;">​</a></h2><p>在每个节点机器上面使用 <code>root</code> 权限执行：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> iptables-save</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -v</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> KUBE</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> iptables-restore</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ipvsadm</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -C</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ip</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> link</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> del</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> kube-ipvs0</span></span></code></pre></div><h2 id="重启节点" tabindex="-1">重启节点 <a class="header-anchor" href="#重启节点" aria-label="Permalink to &quot;重启节点&quot;">​</a></h2><p>执行完之后请务必重启节点。</p>',12);function v(x,A,f,P,D,B){const n=e("NolebasePageProperties"),t=e("VPNolebaseInlineLinkPreview"),h=e("NolebaseGitContributors"),p=e("NolebaseGitChangelog");return d(),o("div",null,[u,a(n),g,s("table",y,[b,s("tbody",null,[s("tr",null,[C,F,s("td",null,[a(t,{href:"https://v1-28.docs.kubernetes.io/",target:"_blank",rel:"noreferrer"},{default:l(()=>[i("https://v1-28.docs.kubernetes.io/")]),_:1})])])])]),s("p",null,[i("根据 "),a(t,{href:"https://tinychen.com/20230201-k8s-15-migrate-cni-from-calico-to-cilium/",target:"_blank",rel:"noreferrer"},{default:l(()=>[i("k8s系列15-calico有损迁移至cilium")]),_:1}),i(" 技术文档所分享的，我们可以在安装前配置和备份一下 "),m,i(" 相关资源和配置文件：")]),_,a(h),a(p)])}const N=k(c,[["render",v]]);export{E as __pageData,N as default};
