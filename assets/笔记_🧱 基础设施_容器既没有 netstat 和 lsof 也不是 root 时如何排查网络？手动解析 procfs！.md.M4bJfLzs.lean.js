import{_ as p,c as e,I as i,j as s,a,w as l,au as t,D as T,o as Q}from"./chunks/framework.RMxno62p.js";const i1=JSON.parse('{"title":"容器既没有 netstat 和 lsof 也不是 root 时如何排查网络？手动解析 procfs！","description":"","frontmatter":{"tags":["命令行/docker","运维/云原生/Docker","运维/云原生/Kubernetes","命令行/kubectl","软件/云原生/containerd","运维/网络","基础设施/应用容器","命令行/apt","操作系统/Linux","计算机/操作系统/Linux/内核/kernel","计算机/操作系统/Linux/内核/procfs"]},"headers":[],"relativePath":"笔记/🧱 基础设施/容器既没有 netstat 和 lsof 也不是 root 时如何排查网络？手动解析 procfs！.md","filePath":"笔记/🧱 基础设施/容器既没有 netstat 和 lsof 也不是 root 时如何排查网络？手动解析 procfs！.md"}'),o={name:"笔记/🧱 基础设施/容器既没有 netstat 和 lsof 也不是 root 时如何排查网络？手动解析 procfs！.md"},k=s("h1",{id:"容器既没有-netstat-和-lsof-也不是-root-时如何排查网络-手动解析-procfs",tabindex:"-1"},[a("容器既没有 "),s("code",null,"netstat"),a(" 和 "),s("code",null,"lsof"),a(" 也不是 "),s("code",null,"root"),a(" 时如何排查网络？手动解析 "),s("code",null,"procfs"),a("！ "),s("a",{class:"header-anchor",href:"#容器既没有-netstat-和-lsof-也不是-root-时如何排查网络-手动解析-procfs","aria-label":'Permalink to "容器既没有 `netstat` 和 `lsof` 也不是 `root` 时如何排查网络？手动解析 `procfs`！"'},"​")],-1),m=t("",6),g=s("code",null,"apt",-1),c=s("code",null,"root",-1),y=t("",10),u=s("code",null,"nsenter",-1),C=s("code",null,"docker",-1),F=s("code",null,"kubectl",-1),H=s("code",null,"nsenter",-1),b=t("",22),L={class:"MathJax",jax:"SVG",display:"true",style:{direction:"ltr",display:"block","text-align":"center",margin:"1em 0",position:"relative"}},V={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-3.658ex"},xmlns:"http://www.w3.org/2000/svg",width:"27.372ex",height:"8.448ex",role:"img",focusable:"false",viewBox:"0 -2117 12098.5 3733.9","aria-hidden":"true"},f=t("",1),x=[f],A=s("mjx-assistive-mml",{unselectable:"on",display:"block",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",overflow:"hidden",width:"100%"}},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[s("mtable",{displaystyle:"true",columnalign:"right center left",columnspacing:"0em 0.278em",rowspacing:"3pt"},[s("mtr",null,[s("mtd",null,[s("msub",null,[s("mn",null,"01"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mi",null,"h"),s("mi",null,"e"),s("mi",null,"x")])])]),s("mtd",null,[s("mi"),s("mo",null,"=")]),s("mtd",null,[s("mrow",{"data-mjx-texclass":"ORD"},[s("mn",null,"0"),s("mo",null,"×"),s("msup",null,[s("mn",null,"16"),s("mn",null,"1")]),s("mo",null,"+"),s("mn",null,"1"),s("mo",null,"×"),s("msup",null,[s("mn",null,"16"),s("mn",null,"0")])])])]),s("mtr",null,[s("mtd"),s("mtd",null,[s("mi"),s("mo",null,"=")]),s("mtd",null,[s("mn",null,"0"),s("mo",null,"+"),s("mn",null,"1")])]),s("mtr",null,[s("mtd"),s("mtd",null,[s("mi"),s("mo",null,"=")]),s("mtd",null,[s("msub",null,[s("mn",null,"1"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mi",null,"d"),s("mi",null,"e"),s("mi",null,"c"),s("mi",null,"i"),s("mi",null,"m"),s("mi",null,"a"),s("mi",null,"l")])])])])]),s("mrow",{"data-mjx-texclass":"ORD"},[s("mo",null,"$")]),s("mrow",{"data-mjx-texclass":"ORD"},[s("mo",null,"$")])])],-1),w=s("p",{decimal:""},"00_{hex} = 0_",-1),_={class:"MathJax",jax:"SVG",display:"true",style:{direction:"ltr",display:"block","text-align":"center",margin:"1em 0",position:"relative"}},M={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.357ex"},xmlns:"http://www.w3.org/2000/svg",width:"17.18ex",height:"2.054ex",role:"img",focusable:"false",viewBox:"0 -750 7593.8 907.8","aria-hidden":"true"},D=t("",1),Z=[D],v=s("mjx-assistive-mml",{unselectable:"on",display:"block",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",overflow:"hidden",width:"100%"}},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[s("mrow",{"data-mjx-texclass":"ORD"},[s("mo",null,"$")]),s("mrow",{"data-mjx-texclass":"ORD"},[s("mo",null,"$")]),s("msub",null,[s("mn",null,"00"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mi",null,"h"),s("mi",null,"e"),s("mi",null,"x")])]),s("mo",null,"="),s("msub",null,[s("mn",null,"0"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mi",null,"d"),s("mi",null,"e"),s("mi",null,"c"),s("mi",null,"i"),s("mi",null,"m"),s("mi",null,"a"),s("mi",null,"l")])])])],-1),B={class:"MathJax",jax:"SVG",display:"true",style:{direction:"ltr",display:"block","text-align":"center",margin:"1em 0",position:"relative"}},E={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-5.129ex"},xmlns:"http://www.w3.org/2000/svg",width:"26.564ex",height:"11.389ex",role:"img",focusable:"false",viewBox:"0 -2767 11741.5 5033.9","aria-hidden":"true"},q=t("",1),P=[q],R=s("mjx-assistive-mml",{unselectable:"on",display:"block",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",overflow:"hidden",width:"100%"}},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[s("mtable",{displaystyle:"true",columnalign:"right center left",columnspacing:"0em 0.278em",rowspacing:"3pt"},[s("mtr",null,[s("mtd",null,[s("mn",null,"7"),s("msub",null,[s("mi",null,"F"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mi",null,"h"),s("mi",null,"e"),s("mi",null,"x")])])]),s("mtd",null,[s("mi"),s("mo",null,"=")]),s("mtd",null,[s("mrow",{"data-mjx-texclass":"ORD"},[s("mn",null,"7"),s("mo",null,"×"),s("msup",null,[s("mn",null,"16"),s("mn",null,"1")]),s("mo",null,"+"),s("mn",null,"14"),s("mo",null,"×"),s("msup",null,[s("mn",null,"16"),s("mn",null,"0")])])])]),s("mtr",null,[s("mtd"),s("mtd",null,[s("mi"),s("mo",null,"=")]),s("mtd",null,[s("mrow",{"data-mjx-texclass":"ORD"},[s("mn",null,"7"),s("mo",null,"×"),s("mn",null,"16"),s("mo",null,"+"),s("mn",null,"15"),s("mo",null,"×"),s("mn",null,"1")])])]),s("mtr",null,[s("mtd"),s("mtd",null,[s("mi"),s("mo",null,"=")]),s("mtd",null,[s("mrow",{"data-mjx-texclass":"ORD"},[s("mn",null,"112"),s("mo",null,"+"),s("mn",null,"15")])])]),s("mtr",null,[s("mtd"),s("mtd",null,[s("mi"),s("mo",null,"=")]),s("mtd",null,[s("msub",null,[s("mn",null,"127"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mi",null,"d"),s("mi",null,"e"),s("mi",null,"c"),s("mi",null,"i"),s("mi",null,"m"),s("mi",null,"a"),s("mi",null,"l")])])])])])])],-1),j=t("",2),z=s("strong",null,"小端序（little-endian）",-1),I=t("",2),S={class:"MathJax",jax:"SVG",display:"true",style:{direction:"ltr",display:"block","text-align":"center",margin:"1em 0",position:"relative"}},O={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-5.129ex"},xmlns:"http://www.w3.org/2000/svg",width:"48.915ex",height:"11.389ex",role:"img",focusable:"false",viewBox:"0 -2767 21620.4 5033.9","aria-hidden":"true"},N=t("",1),$=[N],X=s("mjx-assistive-mml",{unselectable:"on",display:"block",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",overflow:"hidden",width:"100%"}},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[s("mtable",{displaystyle:"true",columnalign:"right center left",columnspacing:"0em 0.278em",rowspacing:"3pt"},[s("mtr",null,[s("mtd",null,[s("mn",null,"22"),s("mi",null,"B"),s("msub",null,[s("mn",null,"8"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mi",null,"h"),s("mi",null,"e"),s("mi",null,"x")])])]),s("mtd",null,[s("mi"),s("mo",null,"=")]),s("mtd",null,[s("mn",null,"2"),s("mo",null,"×"),s("msup",null,[s("mn",null,"16"),s("mn",null,"3")]),s("mo",null,"+"),s("mn",null,"2"),s("mo",null,"×"),s("msup",null,[s("mn",null,"16"),s("mn",null,"2")]),s("mo",null,"+"),s("mn",null,"11"),s("mo",null,"×"),s("msup",null,[s("mn",null,"16"),s("mn",null,"1")]),s("mo",null,"+"),s("mn",null,"8"),s("mo",null,"×"),s("msup",null,[s("mn",null,"16"),s("mn",null,"0")])])]),s("mtr",null,[s("mtd"),s("mtd",null,[s("mi"),s("mo",null,"=")]),s("mtd",null,[s("mn",null,"2"),s("mo",null,"×"),s("mn",null,"4096"),s("mo",null,"+"),s("mn",null,"2"),s("mo",null,"×"),s("mn",null,"256"),s("mo",null,"+"),s("mn",null,"11"),s("mo",null,"×"),s("mn",null,"16"),s("mo",null,"+"),s("mn",null,"8")])]),s("mtr",null,[s("mtd"),s("mtd",null,[s("mi"),s("mo",null,"=")]),s("mtd",null,[s("mn",null,"8192"),s("mo",null,"+"),s("mn",null,"512"),s("mo",null,"+"),s("mn",null,"176"),s("mo",null,"+"),s("mn",null,"8")])]),s("mtr",null,[s("mtd"),s("mtd",null,[s("mi"),s("mo",null,"=")]),s("mtd",null,[s("msub",null,[s("mn",null,"8888"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mi",null,"d"),s("mi",null,"e"),s("mi",null,"c"),s("mi",null,"i"),s("mi",null,"m"),s("mi",null,"a"),s("mi",null,"l")])])])])])])],-1),G=t("",26);function J(U,K,W,Y,s1,a1){const r=T("NolebasePageProperties"),n=T("VPNolebaseInlineLinkPreview"),h=T("NolebaseGitContributors"),d=T("NolebaseGitChangelog");return Q(),e("div",null,[k,i(r),m,s("p",null,[a("我在稍早前的时候发布过另外的一篇有关在缺失工具的容器内进行故障排查的笔记："),i(n,{href:"/笔记/🧱 基础设施/容器里没有 ps 怎么办？.html"},{default:l(()=>[a("容器里没有 ps 怎么办？")]),_:1}),a("，当时的情况是我们既有 "),g,a(" 也有容器的 "),c,a(" 权限，在上述假设中：")]),y,s("p",null,[a("OK，这问题听起来还挺简单的，如果我们能够接触到运行 Docker/containerd/kubelet 的节点设备，恰好节点上也有预装了 "),u,a("，恰好节点上允许你操作 "),C,a(" CLI 或者 "),F,a(" CLI 的时候， 我们可以通过 "),i(n,{href:"https://stackoverflow.com/questions/40350456/docker-any-way-to-list-open-sockets-inside-a-running-docker-container",target:"_blank",rel:"noreferrer"},{default:l(()=>[a("netstat - Docker: any way to list open sockets inside a running docker container? - Stack Overflow")]),_:1}),a(" 介绍的方法，通过 "),H,a(" 把当前所处的 cgroup 命名空间切换到和容器平齐的命名空间上再运行我们的命令：")]),b,s("mjx-container",L,[(Q(),e("svg",V,x)),A]),w,s("mjx-container",_,[(Q(),e("svg",M,Z)),v]),s("mjx-container",B,[(Q(),e("svg",E,P)),R]),j,s("p",null,[a("会发现顺序是反过来的，不要惊慌，因为存储的时候是存储为了"),i(n,{href:"https://zh.wikipedia.org/wiki/%E5%AD%97%E8%8A%82%E5%BA%8F",target:"_blank",rel:"noreferrer"},{default:l(()=>[z]),_:1}),a(" 的格式，在这样的格式中，会首先在低位存储最低有效字节，反倒是我们用十进制表达的时候是采用的大端序格式，因此这就是预期的行为，翻转一下数组就好了：")]),I,s("mjx-container",S,[(Q(),e("svg",O,$)),X]),G,s("ul",null,[s("li",null,[i(n,{href:"https://staaldraad.github.io/2017/12/20/netstat-without-netstat/",target:"_blank",rel:"noreferrer"},{default:l(()=>[a("netstat without netstat | Staaldraad")]),_:1})]),s("li",null,[i(n,{href:"https://webera.blog/how-to-get-listening-ports-inside-a-container-without-the-netstat-or-lsof-command-83e21c772343",target:"_blank",rel:"noreferrer"},{default:l(()=>[a("How to get listening ports inside a container without the netstat or lsof command | by Raphael Moraes | Webera")]),_:1})]),s("li",null,[i(n,{href:"https://dev.to/trexinc/netstat-without-netstat-inside-containers-9ak",target:"_blank",rel:"noreferrer"},{default:l(()=>[a("Netstat without Netstat inside Containers - DEV Community")]),_:1})])]),i(h),i(d)])}const n1=p(o,[["render",J]]);export{i1 as __pageData,n1 as default};
